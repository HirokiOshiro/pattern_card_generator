<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚«ãƒ¼ãƒ‰ç”Ÿæˆãƒ„ãƒ¼ãƒ«</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'ãƒ’ãƒ©ã‚®ãƒè§’ã‚´ ProN', 'Hiragino Kaku Gothic ProN', 'æ¸¸ã‚´ã‚·ãƒƒã‚¯', YuGothic, 'ãƒ¡ã‚¤ãƒªã‚ª', Meiryo, sans-serif;
            background: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .header {
            background: linear-gradient(135deg, #4CAF50 0%, #8BC34A 25%, #CDDC39 50%, #FFC107 75%, #ff0c9ea6 100%);
            color: white;
            padding: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header h1 {
            font-size: 1.8em;
            font-weight: 700;
        }
        
        .header-actions {
            display: flex;
            gap: 15px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: #4CAF50;
            color: white;
        }
        
        .btn-secondary {
            background: #f8f9fa;
            color: #333;
            border: 1px solid #dee2e6;
        }
        
        .header .btn-secondary {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
        }
        
        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            width: 100%;
            box-sizing: border-box;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 30px;
            margin-top: 20px;
            width: 100%;
            max-width: 100%;
            justify-content: center;
        }
        
        .sidebar {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            height: fit-content;
            position: sticky;
            top: 20px;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #444;
            font-size: 14px;
        }
        
        .form-group select,
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
            font-family: inherit;
        }
        
        .form-group select:focus,
        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        /* ãƒ•ã‚©ãƒ³ãƒˆé¸æŠç‰¹æœ‰ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        #fontSelect {
            font-weight: 500;
            background: #fafbfc;
        }
        
        #fontSelect option {
            padding: 8px;
        }
        
        .templates {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .template-btn {
            aspect-ratio: 3/2;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 500;
            background: white;
            position: relative;
            overflow: hidden;
        }
        
        .template-btn:hover {
            border-color: #667eea;
            background: #f8f9ff;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
        }
        
        .template-btn.active {
            border: 3px solid #667eea;
            background: #f8f9ff;
            color: #667eea;
            transform: scale(1.02);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.25);
            font-weight: 600;
        }
        
        .template-btn.active::before {
            content: 'âœ“';
            position: absolute;
            top: 4px;
            right: 6px;
            font-size: 14px;
            font-weight: bold;
            color: #667eea;
            background: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 6px rgba(102, 126, 234, 0.3);
        }
        
        .template-academic { background: linear-gradient(135deg, #ffffff, #d0d0d0); }
        .template-nature { background: linear-gradient(135deg, #259e56, #f4f269); }
        .template-warm { background: linear-gradient(135deg, #fff95b, #ff930f); }
        .template-elegant { background: linear-gradient(135deg, #d4af37, #c0c0c0); }
        .template-pastel { background: linear-gradient(135deg, #e9e9b7, #d3f3f1); }
        .template-spring { background: linear-gradient(135deg, #fce9d7, #eed4e8); }
        .template-summer { background: linear-gradient(135deg, #f6f6f6, #2c6cbc); }
        .template-autumn { background: linear-gradient(135deg, #fdd57e, #924e8c); }
        .template-winter { background: linear-gradient(135deg, #f1f5f9, #475569); }
        .template-custom { background: linear-gradient(135deg, #f5f5f5, #e8e8e8); }
        
        /* ã‚«ãƒ©ãƒ¼ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .color-customization {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 12px;
            background: #fafafa;
        }
        
        .color-inputs {
            display: grid;
            gap: 10px;
        }
        
        .color-input-group {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .color-input-group label {
            font-size: 12px;
            color: #555;
            margin: 0;
        }
        
        .color-input-group input[type="color"] {
            width: 50px;
            height: 30px;
            border: 1px solid #ccc;
            border-radius: 4px;
            cursor: pointer;
            padding: 0;
        }
        
        .palette-management {
            border-top: 1px solid #e0e0e0;
            margin-top: 10px;
            padding-top: 10px;
        }
        
        .saved-palette {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 5px 8px;
            margin: 5px 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
        }
        
        .palette-colors {
            display: flex;
            gap: 3px;
        }
        
        .palette-color-dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 1px solid #ccc;
        }
        
        .palette-actions {
            display: flex;
            gap: 3px;
        }
        
        .palette-action-btn {
            padding: 2px 6px;
            font-size: 10px;
            border: 1px solid #ccc;
            background: white;
            border-radius: 3px;
            cursor: pointer;
        }
        
        .palette-action-btn:hover {
            background: #f0f0f0;
        }
        
        /* ã‚«ãƒ©ãƒ¼ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .custom-color-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 10px;
            background: #f8f9fa;
            border: 1px solid #e1e8ed;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 12px;
            font-size: 13px;
            font-weight: 500;
        }
        
        .custom-color-toggle:hover {
            background: #f0f4f8;
            border-color: #d1d9e0;
        }
        
        .custom-color-toggle input[type="checkbox"] {
            width: 16px;
            height: 16px;
            margin: 0;
            cursor: pointer;
        }
        
        .custom-color-toggle.active {
            background: #e8f4f8;
            border-color: #667eea;
            color: #2c5aa0;
        }
        .template-custom { background: #ffffff; border: 2px solid #e1e8ed; }
        
        .main-area {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        
        .preview-section {
            margin-bottom: 30px;
        }
        
        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .preview-header h2 {
            font-size: 1.4em;
            color: #444;
        }
        
        .canvas-container {
            border: 2px solid #e1e8ed;
            border-radius: 12px;
            overflow: hidden;
            background: #fafbfc;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            max-width: 100%;
            height: 660px; /* 888Ã—600px + ãƒ‘ãƒ‡ã‚£ãƒ³ã‚° */
            margin: 0 auto;
        }
        
        #cardCanvas {
            border: 1px solid #ddd;
            display: block;
            margin: 0 auto;
            max-width: 888px;
            max-height: 600px;
            width: 888px !important;
            height: 600px !important;
        }
        
        .batch-section {
            border-top: 2px solid #f1f3f4;
            padding-top: 30px;
        }
        
        .batch-controls {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .pattern-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 8px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            padding: 15px;
            background: #fafbfc;
        }
        
        .pattern-item {
            padding: 4px 6px;
            border: 1px solid #e1e8ed;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            text-align: center;
            font-size: 11px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 60px;
            word-wrap: break-word;
            overflow: hidden;
            position: relative;
        }
        
        .pattern-item:hover {
            border-color: #667eea;
            background: #f8f9ff;
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(102, 126, 234, 0.12);
        }
        
        .pattern-item.selected {
            background: #f8f9ff;
            color: #667eea;
            border: 2px solid #667eea;
            font-weight: 600;
            transform: scale(1.05);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.2);
        }
        
        .pattern-item.selected::before {
            content: 'âœ“';
            position: absolute;
            top: 2px;
            right: 3px;
            font-size: 10px;
            font-weight: bold;
            color: #667eea;
            background: white;
            border-radius: 50%;
            width: 14px;
            height: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 1px 3px rgba(102, 126, 234, 0.3);
            z-index: 1;
        }
        
        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e1e8ed;
            border-radius: 3px;
            overflow: hidden;
            margin: 20px 0;
            display: none;
        }
        
        .progress-fill {
            height: 100%;
            background: #4CAF50;
            transition: width 0.3s ease;
            width: 0%;
        }
        
        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                position: static;
            }
        }
        
        .info-panel {
            background: #f8f9ff;
            border: 1px solid #e1e8ed;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .info-panel h3 {
            color: #667eea;
            font-size: 14px;
            margin-bottom: 8px;
        }
        
        .info-panel p {
            font-size: 13px;
            color: #666;
            line-height: 1.5;
        }
        
        /* CSVç·¨é›†é–¢é€£ã‚¹ã‚¿ã‚¤ãƒ« */
        .csv-row-editing {
            background: #fff3cd !important;
            border: 2px solid #ffc107 !important;
        }
        
        .csv-edit-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 10px;
            transition: all 0.2s ease;
        }
        
        .csv-edit-button:hover {
            background: #5a6fd8;
            transform: translateY(-1px);
        }

        /* AIæ´»ç”¨ã‚¬ã‚¤ãƒ‰é–¢é€£ã‚¹ã‚¿ã‚¤ãƒ« */
        .ai-guide-section {
            margin-bottom: 30px;
            border: 2px solid #e8f4fd;
            border-radius: 12px;
            background: linear-gradient(135deg, #f8fcff, #e8f4fd);
            overflow: hidden;
        }

        .ai-guide-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .ai-guide-header:hover {
            background: linear-gradient(135deg, #5a6fd8, #6842a0);
        }

        .ai-guide-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 16px;
        }

        .ai-guide-toggle {
            font-size: 18px;
            transition: transform 0.3s ease;
        }

        .ai-guide-toggle.expanded {
            transform: rotate(180deg);
        }

        .ai-guide-content {
            padding: 20px;
            display: none;
        }

        .ai-guide-content.expanded {
            display: block;
        }

        .template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .template-card {
            border: 1px solid #e0e7ff;
            border-radius: 8px;
            padding: 15px;
            background: white;
            transition: all 0.3s ease;
        }

        .template-card:hover {
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
            border-color: #667eea;
        }

        .template-card h4 {
            color: #667eea;
            margin: 0 0 10px 0;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .template-textarea {
            width: 100%;
            min-height: 120px;
            padding: 10px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            resize: vertical;
            background: #f9fafb;
        }

        .copy-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            margin-top: 10px;
            transition: all 0.3s ease;
        }

        .copy-button:hover {
            background: #5a6fd8;
        }

        .copy-button.copied {
            background: #10b981;
        }

        .step-guide {
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .step-guide h4 {
            color: #0369a1;
            margin: 0 0 10px 0;
        }

        .step-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .step-list li {
            padding: 5px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .step-number {
            background: #667eea;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }

        /* ãƒ•ã‚¡ã‚¤ãƒ«åã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºé–¢é€£ã‚¹ã‚¿ã‚¤ãƒ« */
        .file-name-controls {
            border: 1px solid #e0e7ff;
            border-radius: 6px;
            padding: 8px 12px;
            background: #f8fcff;
        }

        .file-name-controls input {
            transition: border-color 0.3s ease;
        }

        .file-name-controls input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
        }

        @media (max-width: 768px) {
            .csv-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .file-name-controls {
                margin-left: 0 !important;
                margin-top: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <h1>ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ»ã‚«ãƒ¼ãƒ‰ç”Ÿæˆãƒ„ãƒ¼ãƒ«</h1>
            <div class="header-actions">
                <button class="btn btn-secondary" onclick="resetAll()">
                    ğŸ”„ ãƒªã‚»ãƒƒãƒˆ
                </button>
                <button class="btn btn-primary" onclick="exportCurrentCard()">
                    ğŸ“‚ ç¾åœ¨ã®ã‚«ãƒ¼ãƒ‰ã‚’ä¿å­˜
                </button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="main-content">
            <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
            <div class="sidebar">
                <div class="info-panel">
                    <h3>ğŸ“š äº•åº­å´‡å…ˆç”Ÿã®ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ»ãƒ©ãƒ³ã‚²ãƒ¼ã‚¸ã‚’æ´»ç”¨ã—ãŸã‚¯ãƒªã‚¨ãƒ†ã‚£ãƒ–ãƒ»ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°ã®è€ƒãˆã‹ã‚‰ç€æƒ³ã‚’å¾—ãŸãƒ„ãƒ¼ãƒ«</h3>
                    <p>äº•åº­å…ˆç”Ÿã®å‰µé€ çš„å­¦ç¿’ã®ãŸã‚ã®40ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚«ãƒ¼ãƒ‰ã‹ã‚‰é¸æŠã—ãŸã‚«ãƒ¼ãƒ‰ã‚’å‡ºåŠ›ã—ãŸã‚Šã€ã‚ªãƒªã‚¸ãƒŠãƒ«ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚«ãƒ¼ãƒ‰ã‚’ä½œæˆã—ã¦å‡ºåŠ›ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p>
                </div>

                <div class="form-group">
                    <label for="patternSelect">ãƒ‘ã‚¿ãƒ¼ãƒ³é¸æŠ</label>
                    <select id="patternSelect" onchange="loadPatternData()">
                        <option value="">ã‚«ã‚¹ã‚¿ãƒ ï¼ˆç‹¬è‡ªä½œæˆï¼‰</option>
                        <option value="0">0. å­¦ç¿’ã‚’ãƒ‡ã‚¶ã‚¤ãƒ³ã™ã‚‹</option>
                        <option value="1">1. æ©Ÿä¼šã‚’ã¤ãã‚‹</option>
                        <option value="2">2. å‰µé€ çš„ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ</option>
                        <option value="3">3. ã‚ªãƒ¼ãƒ—ãƒ³ãƒ—ãƒ­ã‚»ã‚¹ãªå­¦ã³</option>
                        <option value="4">4. ã¾ãšã¯ã¤ã‹ã‚‹</option>
                        <option value="5">5. è¦‹ã¾ã­å­¦ç¿’</option>
                        <option value="6">6. åŠ¹æœçš„ãªè³ªå•</option>
                        <option value="7">7. ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆå¿—å‘ã®å­¦ç¿’</option>
                        <option value="8">8. æ¯æ—¥å¤–å›½èª</option>
                        <option value="9">9. éŠã³å¿ƒã®ã‚ã‚‹å­¦ç¿’</option>
                        <option value="10">10. èº«ä½“åŒ–ã•ã‚ŒãŸã‚¹ã‚­ãƒ«</option>
                        <option value="11">11. è¨€è‘‰ã®ã‚·ãƒ£ãƒ¯ãƒ¼</option>
                        <option value="12">12. æœ‰å½¢ã®è“„ç©</option>
                        <option value="13">13. å­¦ç¿’ã®ç«œå·»</option>
                        <option value="14">14. ä¸‰è§’ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°</option>
                        <option value="15">15. èˆˆå¥®ã®é€£é–ï¼</option>
                        <option value="16">16. è¡Œå‹•ã®ä¸­ã§ã®æ€è€ƒ</option>
                        <option value="17">17. ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ”ãƒ³ã‚°</option>
                        <option value="18">18. ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒ€ã‚¤ãƒ“ãƒ³ã‚°</option>
                        <option value="19">19. ãƒãƒ«ãƒã‚«ãƒ¡ãƒ©æ’®å½±</option>
                        <option value="20">20. é³¥ã®ç›®ãƒ»è™«ã®ç›®</option>
                        <option value="21">21. éš ã‚ŒãŸã¤ãªãŒã‚Š</option>
                        <option value="22">22. ãƒ•ãƒ­ãƒ³ãƒ†ã‚£ã‚¢ç™ºè¦‹è€…</option>
                        <option value="23">23. å‰µé€ çš„ã‚¹ã‚¤ãƒƒãƒ</option>
                        <option value="24">24. æœç‰©è¾²æ¥­</option>
                        <option value="25">25. åˆç¨¿ã¯é“åŠã°</option>
                        <option value="26">26. é­…åŠ›çš„è¡¨ç¾</option>
                        <option value="27">27. æ¬¡ã¸ã®åŠ é€Ÿ</option>
                        <option value="28">28. å­¦ç¿’ã®ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£</option>
                        <option value="29">29. å¶ç„¶ã®å‡ºä¼šã„</option>
                        <option value="30">30. è‰¯ããƒ©ã‚¤ãƒãƒ«</option>
                        <option value="31">31. è©±ã™æ€è€ƒè€…</option>
                        <option value="32">32. æ•™ãˆã‚‹ã“ã¨ã«ã‚ˆã‚‹å­¦ç¿’</option>
                        <option value="33">33. ç¢ºå›ºãŸã‚‹æ±ºæ„</option>
                        <option value="34">34. ç–‘å•ã‚’æŒã¤å¿ƒ</option>
                        <option value="35">35. æ­£ã—ã„æ–¹æ³•</option>
                        <option value="36">36. å‹‡æ•¢ãªå¤‰åŒ–</option>
                        <option value="37">37. æ¢æ¤œå®¶ã®æƒ…ç†±</option>
                        <option value="38">38. è‡ªå·±ãƒ—ãƒ­ãƒ‡ãƒ¥ãƒ¼ã‚µãƒ¼</option>
                        <option value="39">39. æ¥µç«¯ã«ãªã‚Œï¼</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</label>
                    <div class="templates">
                        <!-- åŸºæœ¬ãƒ†ãƒ¼ãƒ -->
                        <div class="template-btn template-academic active" data-template="academic" onclick="selectTemplate('academic')">
                            ã‚¢ã‚«ãƒ‡ãƒŸãƒƒã‚¯
                        </div>
                        <div class="template-btn template-nature" data-template="nature" onclick="selectTemplate('nature')">
                            ãƒŠãƒãƒ¥ãƒ©ãƒ«
                        </div>
                        <div class="template-btn template-warm" data-template="warm" onclick="selectTemplate('warm')">
                            ã‚¦ã‚©ãƒ¼ãƒ 
                        </div>
                        <div class="template-btn template-elegant" data-template="elegant" onclick="selectTemplate('elegant')">
                            ã‚¨ãƒ¬ã‚¬ãƒ³ãƒˆ
                        </div>
                        
                        <!-- æ–°ãƒ†ãƒ¼ãƒ -->
                        <div class="template-btn template-pastel" data-template="pastel" onclick="selectTemplate('pastel')">
                            ãƒ‘ã‚¹ãƒ†ãƒ«
                        </div>
                        
                        <!-- å­£ç¯€ãƒ†ãƒ¼ãƒ -->
                        <div class="template-btn template-spring" data-template="spring" onclick="selectTemplate('spring')">
                            ğŸŒ¸ æ˜¥
                        </div>
                        <div class="template-btn template-summer" data-template="summer" onclick="selectTemplate('summer')">
                            ğŸŒ» å¤
                        </div>
                        <div class="template-btn template-autumn" data-template="autumn" onclick="selectTemplate('autumn')">
                            ğŸ‚ ç§‹
                        </div>
                        <div class="template-btn template-winter" data-template="winter" onclick="selectTemplate('winter')">
                            â„ï¸ å†¬
                        </div>
                        
                        <!-- ã‚«ã‚¹ã‚¿ãƒ  -->
                        <div class="template-btn template-custom" data-template="custom" onclick="selectTemplate('custom')">
                            ğŸ› ï¸ ã‚«ã‚¹ã‚¿ãƒ 
                        </div>
                    </div>
                </div>

                <div class="form-group" id="customBackgroundGroup" style="display: none;">
                    <label for="backgroundUpload">èƒŒæ™¯ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</label>
                    <input type="file" id="backgroundUpload" accept="image/*" onchange="handleBackgroundUpload(event)">
                    <small style="color: #666; font-size: 12px; display: block; margin-top: 5px;">
                        æ¨å¥¨ã‚µã‚¤ã‚º: 888Ã—600px ã¾ãŸã¯åŒã˜æ¯”ç‡ã®ç”»åƒ
                    </small>
                </div>

                <div class="form-group">
                    <label for="fontSelect">ãƒ•ã‚©ãƒ³ãƒˆé¸æŠ</label>
                    <select id="fontSelect" onchange="changeFont()">
                        <option value="hiragino">ãƒ’ãƒ©ã‚®ãƒè§’ã‚´ï¼ˆæ¨™æº–ï¼‰</option>
                        <option value="yugothic">æ¸¸ã‚´ã‚·ãƒƒã‚¯</option>
                        <option value="noto">Noto Sans JP</option>
                        <option value="arial">Arialï¼ˆè‹±èªï¼‰</option>
                        <option value="roboto">Robotoï¼ˆè‹±èªï¼‰</option>
                        <option value="opensans">Open Sansï¼ˆè‹±èªï¼‰</option>
                        <option value="comic">ã‚³ãƒŸãƒƒã‚¯é¢¨</option>
                        <option value="serif">æ˜æœä½“ï¼ˆã‚»ãƒªãƒ•ï¼‰</option>
                    </select>
                    <small style="color: #666; font-size: 12px; display: block; margin-top: 5px;">
                        é¸æŠã—ãŸãƒ•ã‚©ãƒ³ãƒˆã¯ã‚«ãƒ¼ãƒ‰å…¨ä½“ã®ãƒ†ã‚­ã‚¹ãƒˆã«é©ç”¨ã•ã‚Œã¾ã™
                    </small>
                </div>

                <!-- ã‚«ãƒ©ãƒ¼ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºæ©Ÿèƒ½ -->
                <div class="form-group">
                    <label>ğŸ¨ ã‚«ãƒ©ãƒ¼ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º</label>
                    <div class="color-customization">
                        <!-- ã‚«ã‚¹ã‚¿ãƒ ã‚«ãƒ©ãƒ¼æœ‰åŠ¹åŒ– -->
                        <div class="custom-color-toggle" onclick="toggleCustomColorsUI()">
                            <input type="checkbox" id="enableCustomColors" onchange="toggleCustomColors()" onclick="event.stopPropagation()">
                            <span>ã‚«ã‚¹ã‚¿ãƒ ã‚«ãƒ©ãƒ¼ã‚’ä½¿ç”¨</span>
                        </div>
                        
                        <!-- ã‚«ãƒ©ãƒ¼ãƒ”ãƒƒã‚«ãƒ¼ï¼ˆåˆæœŸã¯éè¡¨ç¤ºï¼‰ -->
                        <div id="customColorsPanel" style="display: none;">
                            <div class="color-inputs">
                                <div class="color-input-group">
                                    <label for="primaryColor">èƒŒæ™¯é–‹å§‹è‰²</label>
                                    <input type="color" id="primaryColor" value="#e6f8ff" onchange="updateCustomColors()">
                                </div>
                                <div class="color-input-group">
                                    <label for="secondaryColor">èƒŒæ™¯çµ‚äº†è‰²</label>
                                    <input type="color" id="secondaryColor" value="#0077ff" onchange="updateCustomColors()">
                                </div>
                                <div class="color-input-group">
                                    <label for="accentColor">è¦ç´ èƒŒæ™¯è‰²</label>
                                    <input type="color" id="accentColor" value="#ffffff" onchange="updateCustomColors()">
                                </div>
                            </div>
                            
                            <!-- ã‚«ã‚¹ã‚¿ãƒ ãƒ‘ãƒ¬ãƒƒãƒˆä¿å­˜ -->
                            <div class="palette-management">
                                <div style="display: flex; gap: 5px; margin-top: 10px;">
                                    <input type="text" id="paletteNameInput" placeholder="ãƒ‘ãƒ¬ãƒƒãƒˆå" style="flex: 1; padding: 4px;">
                                    <button type="button" onclick="saveCustomPalette()" style="padding: 4px 8px; font-size: 12px;">ä¿å­˜</button>
                                </div>
                                
                                <!-- ä¿å­˜æ¸ˆã¿ãƒ‘ãƒ¬ãƒƒãƒˆä¸€è¦§ -->
                                <div id="savedPalettes" style="margin-top: 10px;"></div>
                            </div>
                        </div>
                    </div>
                    <small style="color: #666; font-size: 12px; display: block; margin-top: 5px;">
                        ç‹¬è‡ªã®ãƒ–ãƒ©ãƒ³ãƒ‰ã‚«ãƒ©ãƒ¼ã§ã‚«ãƒ¼ãƒ‰ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã¾ã™ï¼ˆæœ€å¤§6å€‹ä¿å­˜å¯èƒ½ï¼‰
                    </small>
                </div>

                <div class="form-group">
                    <label for="resolutionSelect">å‡ºåŠ›ã‚µã‚¤ã‚º</label>
                    <select id="resolutionSelect" disabled>
                        <option value="1.5" selected>ä¸­è§£åƒåº¦ (888Ã—600px) - å°åˆ·æœ€é©åŒ–</option>
                    </select>
                    <small style="color: #666; font-size: 12px; display: block; margin-top: 5px;">
                        å°åˆ·ã¨Webè¡¨ç¤ºã®ä¸¡æ–¹ã«é©ã—ãŸæœ€é©åŒ–ã‚µã‚¤ã‚ºã«å›ºå®šã•ã‚Œã¦ã„ã¾ã™
                    </small>
                </div>

                <div class="form-group">
                    <label for="patternTitle">ãƒ‘ã‚¿ãƒ¼ãƒ³å</label>
                    <input type="text" id="patternTitle" placeholder="ãƒ‘ã‚¿ãƒ¼ãƒ³åã‚’å…¥åŠ›" oninput="updateCard()">
                </div>

                <div class="form-group">
                    <label for="patternDescription">èª¬æ˜</label>
                    <textarea id="patternDescription" placeholder="ãƒ‘ã‚¿ãƒ¼ãƒ³ã®èª¬æ˜ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..." oninput="updateCard()"></textarea>
                </div>

                <div class="form-group">
                    <label for="patternContext">å ´é¢ãƒ»çŠ¶æ³</label>
                    <textarea id="patternContext" placeholder="ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒé©ç”¨ã•ã‚Œã‚‹å ´é¢ã‚„çŠ¶æ³ã‚’è¨˜è¿°..." oninput="updateCard()"></textarea>
                </div>

                <div class="form-group">
                    <label for="patternSolution">å·¥å¤«ãƒ»ãƒˆãƒ©ã‚¤ã‚¢ãƒ«</label>
                    <textarea id="patternSolution" placeholder="èª²é¡Œã«å¯¾ã™ã‚‹å·¥å¤«ã‚„è©¦ã—ã¦ã¿ãŸã„ã“ã¨ã‚’è¨˜è¿°..." oninput="updateCard()"></textarea>
                </div>
            </div>

            <!-- ãƒ¡ã‚¤ãƒ³ã‚¨ãƒªã‚¢ -->
            <div class="main-area">
                <!-- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                <div class="preview-section">
                    <div class="preview-header">
                        <h2>ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h2>
                        <span style="color: #666; font-size: 14px;">å›ºå®šã‚µã‚¤ã‚ºï¼ˆ888Ã—600pxï¼‰</span>
                    </div>
                    <div class="canvas-container">
                        <canvas id="cardCanvas"></canvas>
                    </div>
                </div>

                <!-- ä¸€æ‹¬ç”Ÿæˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                <div class="batch-section">
                    <!-- AIæ´»ç”¨ã‚¬ã‚¤ãƒ‰ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                    <div class="ai-guide-section">
                        <div class="ai-guide-header" onclick="toggleAIGuide()">
                            <div class="ai-guide-title">
                                <span>ğŸ¤–</span>
                                <span>AIã‚’æ´»ç”¨ã—ãŸãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ»ã‚«ãƒ¼ãƒ‰ã®ä½œæˆ - CSVè‡ªå‹•ç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ  â€»ã‚¯ãƒªãƒƒã‚¯ã—ã¦å±•é–‹</span>
                            </div>
                            <span class="ai-guide-toggle" id="aiGuideToggle">â–¼</span>
                        </div>
                        <div class="ai-guide-content" id="aiGuideContent">
                            <div class="step-guide">
                                <h4>ğŸš€ ä½¿ã„æ–¹ã®æµã‚Œ</h4>
                                <ul class="step-list">
                                    <li><span class="step-number">1</span>ä¸‹è¨˜ã‹ã‚‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠ</li>
                                    <li><span class="step-number">2</span>ğŸ“‹ ã‚³ãƒ”ãƒ¼ãƒœã‚¿ãƒ³ã§ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ã‚³ãƒ”ãƒ¼</li>
                                    <li><span class="step-number">3</span>ChatGPTç­‰ã®ç”ŸæˆAIã«è²¼ã‚Šä»˜ã‘ã¦å®Ÿè¡Œ</li>
                                    <li><span class="step-number">4</span>ç”Ÿæˆã•ã‚ŒãŸCSVã‚’ä»¥ä¸‹"ã‚«ã‚¹ã‚¿ãƒ ã‚«ãƒ¼ãƒ‰ä½œæˆç”¨CSVä¸€æ‹¬èª­ã¿è¾¼ã¿"ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§èª­ã¿è¾¼ã¿</li>
                                </ul>
                            </div>
                            
                            <div class="template-grid">
                                <!-- æ›¸ç±æŒ‡å®šç”¨ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ -->
                                <div class="template-card">
                                    <h4>ğŸ“š æ›¸ç±æŒ‡å®šç”¨</h4>
                                    <textarea class="template-textarea" readonly>ã€Œ[æ›¸ç±åã‚’å…¥åŠ›]ã€ã®å†…å®¹ã‹ã‚‰ã€å€‹äººã®å­¦ç¿’ãƒ»æˆé•·ã‚’ä¿ƒé€²ã™ã‚‹è¡Œå‹•ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’10-15å€‹æŠ½å‡ºã—ã€ä»¥ä¸‹ã®CSVå½¢å¼ã§å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚

CSVãƒ˜ãƒƒãƒ€ãƒ¼ï¼š
pattern_number,title,description,context,solution

æ¡ä»¶ï¼š
- pattern_numberã¯1ã‹ã‚‰é€£ç•ªã§ç•ªå·ã‚’æŒ¯ã‚‹
- titleã¯ãƒ‘ã‚¿ãƒ¼ãƒ³åã‚’ç°¡æ½”ã«ï¼ˆå…¨è§’28æ–‡å­—ä»¥å†…ï¼‰
- descriptionã¯èª¬æ˜æ–‡ã‚’å…¨è§’50æ–‡å­—ä»¥å†…ã§ç°¡æ½”ã«
- contextã¯ã€Œã€œãªçŠ¶æ³ã§ã€ã¨ã„ã†å½¢ã§è¨˜è¿°ï¼ˆå…¨è§’50æ–‡å­—ä»¥å†…ï¼‰
- solutionã¯å…·ä½“çš„ãªè¡Œå‹•ã¨ã—ã¦è¨˜è¿°ï¼ˆå…¨è§’50æ–‡å­—ä»¥å†…ï¼‰

å‡ºåŠ›å½¢å¼ï¼š
ä»¥ä¸‹ã®æ¡ä»¶ã§CSVãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã®ã¿ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’.csvå½¢å¼ã‚‚ã—ãã¯.txtå½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹ã‚ˆã†ã«å‡ºåŠ›ã—ã¦ãã ã•ã„ï¼š
ãƒ»ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã®typeã‚’"text/csv"ã«è¨­å®šã™ã‚‹
ãƒ»MIMEã‚¿ã‚¤ãƒ—ã‚’CSVå½¢å¼ã¨ã—ã¦èªè­˜ã•ã›ã‚‹
ãƒ»å¯èƒ½ãªå ´åˆã¯ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ç”¨CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ã€ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ç”¨ã®ãƒªãƒ³ã‚¯ã‚’ç™ºè¡Œã—ã¦ãã ã•ã„
ãƒ»1è¡Œç›®ï¼šãƒ˜ãƒƒãƒ€ãƒ¼è¡Œï¼ˆpattern_number,title,description,context,solutionï¼‰
ãƒ»2è¡Œç›®ä»¥é™ï¼šãƒ‡ãƒ¼ã‚¿è¡Œï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã€æ”¹è¡ŒåŒºåˆ‡ã‚Šï¼‰
ãƒ»èª¬æ˜æ–‡ã‚„ãã®ä»–ã®ãƒ†ã‚­ã‚¹ãƒˆã¯ä¸€åˆ‡å«ã‚ãªã„
ãƒ»CSVãƒ‡ãƒ¼ã‚¿ã®ã¿ã‚’å‡ºåŠ›ã™ã‚‹

ä¾‹ï¼š
pattern_number,title,description,context,solution
1,ç–‘å•é§†å‹•å‹ã®å­¦ç¿’,ã€Œãªãœï¼Ÿã€ã‚’èµ·ç‚¹ãƒ»è¶³å ´ã«ã—ãªãŒã‚‰æ·±ã„ç†è§£ã¸ã®é“ç­‹ã‚’æ¢ã‚‹,æ–°ã—ã„æ¦‚å¿µã«å‡ºä¼šã£ãŸãŒãã®æœ¬è³ªãŒè¦‹ãˆãªã„çŠ¶æ³ã§,ã¾ãšã€Œã“ã‚Œã¯ä½•ã®ãŸã‚ã«ã‚ã‚‹ã®ã‹ï¼Ÿãªã„ã¨ã©ã†ãªã‚‹ã®ã‹ï¼Ÿã€ã¨å•ã„ã‹ã‘é–¢é€£æ€§ã‚’æ¢ã£ã¦ã¿ã‚‹</textarea>
                                    <button class="copy-button" onclick="copyTemplate(this, 'book')">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
                                </div>

                                <!-- è³‡æ–™ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ç”¨ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ -->
                                <div class="template-card">
                                    <h4>ğŸ“„ è³‡æ–™ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ç”¨</h4>
                                    <textarea class="template-textarea" readonly>ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸè³‡æ–™ã®å†…å®¹ã‹ã‚‰ã€å€‹äººã®å­¦ç¿’ãƒ»æˆé•·ã‚’ä¿ƒé€²ã™ã‚‹è¡Œå‹•ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’10-15å€‹æŠ½å‡ºã—ã€ä»¥ä¸‹ã®CSVå½¢å¼ã§å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚

CSVãƒ˜ãƒƒãƒ€ãƒ¼ï¼š
pattern_number,title,description,context,solution

æ¡ä»¶ï¼š
- pattern_numberã¯1ã‹ã‚‰é€£ç•ªã§ç•ªå·ã‚’æŒ¯ã‚‹
- titleã¯ãƒ‘ã‚¿ãƒ¼ãƒ³åã‚’ç°¡æ½”ã«ï¼ˆå…¨è§’28æ–‡å­—ä»¥å†…ï¼‰
- descriptionã¯èª¬æ˜æ–‡ã‚’å…¨è§’50æ–‡å­—ä»¥å†…ã§ç°¡æ½”ã«
- contextã¯ã€Œã€œãªçŠ¶æ³ã§ã€ã¨ã„ã†å½¢ã§è¨˜è¿°ï¼ˆå…¨è§’50æ–‡å­—ä»¥å†…ï¼‰
- solutionã¯å…·ä½“çš„ãªè¡Œå‹•ã¨ã—ã¦è¨˜è¿°ï¼ˆå…¨è§’50æ–‡å­—ä»¥å†…ï¼‰

å‡ºåŠ›å½¢å¼ï¼š
ä»¥ä¸‹ã®æ¡ä»¶ã§CSVãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã®ã¿ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’.csvå½¢å¼ã‚‚ã—ãã¯.txtå½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹ã‚ˆã†ã«å‡ºåŠ›ã—ã¦ãã ã•ã„ï¼š
ãƒ»ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã®typeã‚’"text/csv"ã«è¨­å®šã™ã‚‹
ãƒ»MIMEã‚¿ã‚¤ãƒ—ã‚’CSVå½¢å¼ã¨ã—ã¦èªè­˜ã•ã›ã‚‹
ãƒ»å¯èƒ½ãªå ´åˆã¯ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ç”¨CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ã€ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ç”¨ã®ãƒªãƒ³ã‚¯ã‚’ç™ºè¡Œã—ã¦ãã ã•ã„
ãƒ»1è¡Œç›®ï¼šãƒ˜ãƒƒãƒ€ãƒ¼è¡Œï¼ˆpattern_number,title,description,context,solutionï¼‰
ãƒ»2è¡Œç›®ä»¥é™ï¼šãƒ‡ãƒ¼ã‚¿è¡Œï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã€æ”¹è¡ŒåŒºåˆ‡ã‚Šï¼‰
ãƒ»èª¬æ˜æ–‡ã‚„ãã®ä»–ã®ãƒ†ã‚­ã‚¹ãƒˆã¯ä¸€åˆ‡å«ã‚ãªã„
ãƒ»CSVãƒ‡ãƒ¼ã‚¿ã®ã¿ã‚’å‡ºåŠ›ã™ã‚‹

ä¾‹ï¼š
pattern_number,title,description,context,solution
1,ä¾¡å€¤åŸºæº–ã®è¦‹æ¥µã‚,æœ¬å½“ã«é‡è¦ãªã“ã¨ã‚’åˆ¤æ–­ã™ã‚‹æ€è€ƒãƒ—ãƒ­ã‚»ã‚¹ã‚’å‘¼ã³èµ·ã“ã™,å¤šãã®ã‚¿ã‚¹ã‚¯ã«è¿½ã‚ã‚Œä½•ã‹ã‚‰æ‰‹ã‚’ã¤ã‘ã‚‹ã¹ãã‹è¿·ã†çŠ¶æ³ã§,ã€Œã“ã‚Œã¯è‡ªåˆ†ã®ç›®æ¨™ã«ã©ã†çµã³ã¤ã‘ã‚‰ã‚Œã‚‹ã®ã‹ï¼Ÿã€ã¨è‡ªå•ã—ã¦é¸æŠã—ã¦ã¿ã‚‹</textarea>
                                    <button class="copy-button" onclick="copyTemplate(this, 'document')">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
                                </div>

                                <!-- ã‚¦ã‚§ãƒ–ãƒªãƒ³ã‚¯ç”¨ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ -->
                                <div class="template-card">
                                    <h4>ğŸ”— ã‚¦ã‚§ãƒ–ãƒªãƒ³ã‚¯ç”¨</h4>
                                    <textarea class="template-textarea" readonly>æ¬¡ã®ãƒªãƒ³ã‚¯å…ˆã®å†…å®¹ã‹ã‚‰ã€å€‹äººã®å­¦ç¿’ãƒ»æˆé•·ã‚’ä¿ƒé€²ã™ã‚‹è¡Œå‹•ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’10-15å€‹æŠ½å‡ºã—ã€ä»¥ä¸‹ã®CSVå½¢å¼ã§å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚â†’[URL ã‚’å…¥åŠ›]

CSVãƒ˜ãƒƒãƒ€ãƒ¼ï¼š
pattern_number,title,description,context,solution

æ¡ä»¶ï¼š
- pattern_numberã¯1ã‹ã‚‰é€£ç•ªã§ç•ªå·ã‚’æŒ¯ã‚‹
- titleã¯ãƒ‘ã‚¿ãƒ¼ãƒ³åã‚’ç°¡æ½”ã«ï¼ˆå…¨è§’28æ–‡å­—ä»¥å†…ï¼‰
- descriptionã¯èª¬æ˜æ–‡ã‚’å…¨è§’50æ–‡å­—ä»¥å†…ã§ç°¡æ½”ã«
- contextã¯ã€Œã€œãªçŠ¶æ³ã§ã€ã¨ã„ã†å½¢ã§è¨˜è¿°ï¼ˆå…¨è§’50æ–‡å­—ä»¥å†…ï¼‰
- solutionã¯å…·ä½“çš„ãªè¡Œå‹•ã¨ã—ã¦è¨˜è¿°ï¼ˆå…¨è§’50æ–‡å­—ä»¥å†…ï¼‰

å‡ºåŠ›å½¢å¼ï¼š
ä»¥ä¸‹ã®æ¡ä»¶ã§CSVãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã®ã¿ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’.csvå½¢å¼ã‚‚ã—ãã¯.txtå½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹ã‚ˆã†ã«å‡ºåŠ›ã—ã¦ãã ã•ã„ï¼š
ãƒ»ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã®typeã‚’"text/csv"ã«è¨­å®šã™ã‚‹
ãƒ»MIMEã‚¿ã‚¤ãƒ—ã‚’CSVå½¢å¼ã¨ã—ã¦èªè­˜ã•ã›ã‚‹
ãƒ»å¯èƒ½ãªå ´åˆã¯ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ç”¨CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ã€ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ç”¨ã®ãƒªãƒ³ã‚¯ã‚’ç™ºè¡Œã—ã¦ãã ã•ã„
ãƒ»1è¡Œç›®ï¼šãƒ˜ãƒƒãƒ€ãƒ¼è¡Œï¼ˆpattern_number,title,description,context,solutionï¼‰
ãƒ»2è¡Œç›®ä»¥é™ï¼šãƒ‡ãƒ¼ã‚¿è¡Œï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã€æ”¹è¡ŒåŒºåˆ‡ã‚Šï¼‰
ãƒ»èª¬æ˜æ–‡ã‚„ãã®ä»–ã®ãƒ†ã‚­ã‚¹ãƒˆã¯ä¸€åˆ‡å«ã‚ãªã„
ãƒ»CSVãƒ‡ãƒ¼ã‚¿ã®ã¿ã‚’å‡ºåŠ›ã™ã‚‹

ä¾‹ï¼š
pattern_number,title,description,context,solution
1,å†…ç™ºçš„å‹•æ©Ÿã®ç™ºè¦‹,ã€Œãªãœã“ã‚Œã‚’ã‚„ã‚ŠãŸã„ã®ã‹ï¼Ÿã€ã‚’å•ã„ã‹ã‘ç¢ºèªã—ãªãŒã‚‰é€²ã‚€,æ–°ã—ã„ç¿’æ…£ã‚’å§‹ã‚ã¦ã‚‚ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ãŒç¶šã‹ãªã„çŠ¶æ³ã§,ã€Œã“ã‚ŒãŒé”æˆã•ã‚ŒãŸã‚‰è‡ªåˆ†ã®ä½•ãŒã©ã†å¤‰ã‚ã‚Šãã†ã‹ï¼Ÿã€ã¨æƒ³åƒã—ã¦ã¿ã‚‹</textarea>
                                    <button class="copy-button" onclick="copyTemplate(this, 'web')">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
                                </div>

                                <!-- è‡ªç”±ãƒ†ãƒ¼ãƒç”¨ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ -->
                                <div class="template-card">
                                    <h4>ğŸ’­ è‡ªç”±ãƒ†ãƒ¼ãƒç”¨</h4>
                                    <textarea class="template-textarea" readonly>ã€Œ[ãƒ†ãƒ¼ãƒã‚’å…¥åŠ›ï¼ˆä¾‹ï¼šãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°å­¦ç¿’ã€èªå­¦ç¿’å¾—ã€ã‚­ãƒ£ãƒªã‚¢é–‹ç™ºãªã©ï¼‰ã€ã«é–¢ã™ã‚‹å€‹äººã®å­¦ç¿’ãƒ»æˆé•·ã‚’ä¿ƒé€²ã™ã‚‹è¡Œå‹•ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’10-15å€‹ä½œæˆã—ã€ä»¥ä¸‹ã®CSVå½¢å¼ã§å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚

CSVãƒ˜ãƒƒãƒ€ãƒ¼ï¼š
pattern_number,title,description,context,solution

æ¡ä»¶ï¼š
- pattern_numberã¯1ã‹ã‚‰é€£ç•ªã§ç•ªå·ã‚’æŒ¯ã‚‹
- titleã¯ãƒ‘ã‚¿ãƒ¼ãƒ³åã‚’ç°¡æ½”ã«ï¼ˆå…¨è§’28æ–‡å­—ä»¥å†…ï¼‰
- descriptionã¯èª¬æ˜æ–‡ã‚’å…¨è§’50æ–‡å­—ä»¥å†…ã§ç°¡æ½”ã«
- contextã¯ã€Œã€œãªçŠ¶æ³ã§ã€ã¨ã„ã†å½¢ã§è¨˜è¿°ï¼ˆå…¨è§’50æ–‡å­—ä»¥å†…ï¼‰
- solutionã¯å…·ä½“çš„ãªè¡Œå‹•ã¨ã—ã¦è¨˜è¿°ï¼ˆå…¨è§’50æ–‡å­—ä»¥å†…ï¼‰

å‡ºåŠ›å½¢å¼ï¼š
ä»¥ä¸‹ã®æ¡ä»¶ã§CSVãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã®ã¿ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’.csvå½¢å¼ã‚‚ã—ãã¯.txtå½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹ã‚ˆã†ã«å‡ºåŠ›ã—ã¦ãã ã•ã„ï¼š
ãƒ»ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã®typeã‚’"text/csv"ã«è¨­å®šã™ã‚‹
ãƒ»MIMEã‚¿ã‚¤ãƒ—ã‚’CSVå½¢å¼ã¨ã—ã¦èªè­˜ã•ã›ã‚‹
ãƒ»å¯èƒ½ãªå ´åˆã¯ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ç”¨CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ã€ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ç”¨ã®ãƒªãƒ³ã‚¯ã‚’ç™ºè¡Œã—ã¦ãã ã•ã„
ãƒ»1è¡Œç›®ï¼šãƒ˜ãƒƒãƒ€ãƒ¼è¡Œï¼ˆpattern_number,title,description,context,solutionï¼‰
ãƒ»2è¡Œç›®ä»¥é™ï¼šãƒ‡ãƒ¼ã‚¿è¡Œï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã€æ”¹è¡ŒåŒºåˆ‡ã‚Šï¼‰
ãƒ»èª¬æ˜æ–‡ã‚„ãã®ä»–ã®ãƒ†ã‚­ã‚¹ãƒˆã¯ä¸€åˆ‡å«ã‚ãªã„
ãƒ»CSVãƒ‡ãƒ¼ã‚¿ã®ã¿ã‚’å‡ºåŠ›ã™ã‚‹

ä¾‹ï¼š
pattern_number,title,description,context,solution
1,ã‚³ãƒ¼ãƒ‰ã¨ã®å¯¾è©±,ã‚³ãƒ¼ãƒ‰ã¨ã®ã€Œä¼šè©±ã€ã‚’é€šã˜ã¦å€‹ã€…ã®è¦ç´ ã‚’çµã³ã¤ã‘ãªãŒã‚‰ç†è§£ã‚’æ·±ã‚ã¦ã„ã,è¤‡é›‘ãªã‚³ãƒ¼ãƒ‰ã‚’å‰ã«ã—ã¦ç†è§£ãŒé€²ã¾ãªã„çŠ¶æ³ã§,ã€Œã“ã®å‡¦ç†ã¯ä½•ã‚’è§£æ±ºã—ã‚ˆã†ã¨ã—ã¦ã„ã‚‹ã®ã‹ï¼Ÿã€ã¨å•ã„ã‹ã‘ã¦ã¿ã‚‹</textarea>
                                    <button class="copy-button" onclick="copyTemplate(this, 'theme')">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- CSVä¸€æ‹¬èª­ã¿è¾¼ã¿ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                    <div class="csv-section" style="margin-bottom: 40px; padding-bottom: 30px; border-bottom: 2px solid #f1f3f4;">
                        <h2 style="margin-bottom: 20px; color: #444;">ğŸ“„ ã‚«ã‚¹ã‚¿ãƒ ã‚«ãƒ¼ãƒ‰ä½œæˆç”¨CSVä¸€æ‹¬èª­ã¿è¾¼ã¿</h2>
                        <div class="info-panel" style="margin-bottom: 15px;">
                            <h3>ğŸ’¡ ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿æ©Ÿèƒ½</h3>
                            <p>ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆCSVå½¢å¼ï¼‰ã‹ã‚‰è¤‡æ•°ã®ã‚«ã‚¹ã‚¿ãƒ ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚«ãƒ¼ãƒ‰ã‚’ä¸€æ‹¬ç”Ÿæˆã§ãã¾ã™ã€‚<br>
                            <strong>âœ¨ AIãƒ„ãƒ¼ãƒ«å¯¾å¿œ</strong>ï¼šClaudeç­‰ã§ä½œæˆã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ãŒ.txtå½¢å¼ã§ã‚‚èª­ã¿è¾¼ã‚ã¾ã™<br>
                            <strong>ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</strong>ï¼šç¾åœ¨é¸æŠä¸­ã®ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒå…¨ã‚«ãƒ¼ãƒ‰ã«é©ç”¨ã•ã‚Œã¾ã™<br>
                            <strong>ãƒ‘ã‚¿ãƒ¼ãƒ³ç•ªå·</strong>ï¼šãƒ‡ãƒ¼ã‚¿ã®ç•ªå·åˆ—ã«å€¤ãŒã‚ã‚Œã°ã‚«ãƒ¼ãƒ‰ã«è¡¨ç¤ºã•ã‚Œã¾ã™</p>
                            
                            <div style="margin-top: 10px; padding: 8px; background: #e8f4fd; border-radius: 4px; font-size: 13px;">
                                <strong>ğŸ“– å¯¾å¿œãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼</strong><br>
                                â€¢ <strong>.csv ãƒ•ã‚¡ã‚¤ãƒ«</strong>ï¼šExcelç­‰ã§ä½œæˆã—ãŸæ¨™æº–çš„ãªCSVãƒ•ã‚¡ã‚¤ãƒ«<br>
                                â€¢ <strong>.txt ãƒ•ã‚¡ã‚¤ãƒ«</strong>ï¼šClaudeç­‰ã®AIãƒ„ãƒ¼ãƒ«ã§ä½œæˆã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«<br>
                                <small>â€»ã©ã¡ã‚‰ã‚‚CSVå½¢å¼ï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰ã®å†…å®¹ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™</small>
                            </div>
                        </div>
                        
                        <div class="csv-controls" style="display: flex; gap: 15px; align-items: center; margin-bottom: 15px; flex-wrap: wrap;">
                            <input type="file" id="csvFileInput" accept=".csv,.txt" style="display: none;" onchange="handleCSVUpload(event)">
                            <button class="btn btn-secondary" onclick="document.getElementById('csvFileInput').click()">
                                ğŸ“ ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠï¼ˆCSVãƒ»TXTå¯¾å¿œï¼‰
                            </button>
                            <button class="btn btn-secondary" onclick="downloadCSVTemplate()" title="ã‚µãƒ³ãƒ—ãƒ«CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰">
                                ğŸ“‹ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆDL
                            </button>
                            
                            <!-- ãƒ•ã‚¡ã‚¤ãƒ«åã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºæ©Ÿèƒ½ -->
                            <div style="display: none; align-items: center; gap: 10px; margin-left: 20px;" id="fileNameCustomization" class="file-name-controls">
                                <label for="cardGroupName" style="font-size: 14px; color: #444; white-space: nowrap;">ã‚«ãƒ¼ãƒ‰ã‚°ãƒ«ãƒ¼ãƒ—å:</label>
                                <input type="text" id="cardGroupName" placeholder="ä¾‹ï¼šãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆA" 
                                       style="padding: 6px 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; width: 140px;"
                                       title="ãƒ•ã‚¡ã‚¤ãƒ«åã®æ¥é ­è¾ã¨ãªã‚Šã¾ã™ï¼ˆä¾‹ï¼šãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆA_1.pngï¼‰">
                                <small style="color: #666; font-size: 12px; white-space: nowrap;">â†’ {ã‚°ãƒ«ãƒ¼ãƒ—å}_{ç•ªå·}.png</small>
                            </div>
                            
                            <!-- ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ–¹å¼é¸æŠ -->
                            <div id="downloadMethodSection" style="display: none; margin-bottom: 15px; padding: 10px; background: #f8f9ff; border: 1px solid #e1e8ed; border-radius: 6px;">
                                <label style="font-size: 14px; color: #444; margin-bottom: 8px; display: block;">ğŸ“¦ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ–¹å¼:</label>
                                <div style="display: flex; gap: 15px; align-items: center;">
                                    <label style="display: flex; align-items: center; cursor: pointer;">
                                        <input type="radio" name="downloadMethod" value="individual" checked 
                                               style="margin-right: 6px;">
                                        <span style="font-size: 13px;">å€‹åˆ¥ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</span>
                                    </label>
                                    <label style="display: flex; align-items: center; cursor: pointer;">
                                        <input type="radio" name="downloadMethod" value="zip" 
                                               style="margin-right: 6px;">
                                        <span style="font-size: 13px;">ZIPä¸€æ‹¬ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</span>
                                    </label>
                                </div>
                            </div>
                            
                            <button class="btn btn-primary" onclick="generateCSVBatch()" id="generateCSVBtn" style="display: none;">
                                ğŸ¨ CSVãƒ‡ãƒ¼ã‚¿ã‚’ä¸€æ‹¬ç”Ÿæˆ
                            </button>
                            
                            <!-- CSVã‚»ã‚¯ã‚·ãƒ§ãƒ³å°‚ç”¨ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ -->
                            <div class="progress-bar" id="csvProgressBar" style="display: none;">
                                <div class="progress-fill" id="csvProgressFill"></div>
                            </div>
                        </div>
                        
                        <div id="csvPreview" style="display: none;">
                            <h4 style="margin-bottom: 10px; color: #667eea;">ğŸ“Š èª­ã¿è¾¼ã¿äºˆå®šã®ãƒ‡ãƒ¼ã‚¿</h4>
                            <div id="csvDataTable" style="max-height: 200px; overflow-y: auto; border: 1px solid #e1e8ed; border-radius: 6px; background: #fafbfc;">
                                <!-- CSVãƒ‡ãƒ¼ã‚¿ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã‚‹ -->
                            </div>
                            <div id="csvStats" style="margin-top: 10px; font-size: 13px; color: #666;">
                                <!-- çµ±è¨ˆæƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã‚‹ -->
                            </div>
                            
                            <!-- CSVè¡Œç·¨é›†ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆCSVãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç›´ä¸‹ã«é…ç½®ï¼‰ -->
                            <div id="csvEditSection" style="display: none; margin-top: 15px; padding: 15px; background: #f8f9ff; border: 1px solid #e1e8ed; border-radius: 8px;">
                                <h4 style="color: #667eea; margin-bottom: 15px; font-size: 16px;">ğŸ“ CSVè¡Œç·¨é›†</h4>
                                
                                <div style="margin-bottom: 15px;">
                                    <div id="csvEditInfo" style="font-size: 12px; color: #666; background: #fff; padding: 8px; border-radius: 4px; border: 1px solid #ddd;"></div>
                                </div>
                                
                                <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 15px;">
                                    <!-- å·¦å´ï¼šåŸºæœ¬æƒ…å ± -->
                                    <div>
                                        <div style="margin-bottom: 12px;">
                                            <label for="csvEditNumber" style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 4px;">ãƒ‘ã‚¿ãƒ¼ãƒ³ç•ªå·</label>
                                            <input type="text" id="csvEditNumber" style="width: 100%; padding: 6px; font-size: 12px; border: 1px solid #ddd; border-radius: 4px;" oninput="updateCardFromCSVEdit()">
                                        </div>
                                        
                                        <div style="margin-bottom: 12px;">
                                            <label for="csvEditTitle" style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 4px;">ã‚¿ã‚¤ãƒˆãƒ«</label>
                                            <input type="text" id="csvEditTitle" style="width: 100%; padding: 6px; font-size: 12px; border: 1px solid #ddd; border-radius: 4px;" oninput="updateCardFromCSVEdit()">
                                        </div>
                                        
                                        <div style="display: flex; gap: 8px; margin-top: 15px;">
                                            <button class="btn btn-primary" onclick="applyCSVEdit()" style="flex: 1; padding: 8px; font-size: 12px;">âœ… é©ç”¨</button>
                                            <button class="btn btn-secondary" onclick="cancelCSVEdit()" style="flex: 1; padding: 8px; font-size: 12px;">âŒ ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                                        </div>
                                    </div>
                                    
                                    <!-- å³å´ï¼šè©³ç´°æƒ…å ± -->
                                    <div>
                                        <div style="margin-bottom: 12px;">
                                            <label for="csvEditDescription" style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 4px;">èª¬æ˜</label>
                                            <textarea id="csvEditDescription" style="width: 100%; min-height: 50px; padding: 6px; font-size: 12px; border: 1px solid #ddd; border-radius: 4px; resize: vertical;" oninput="updateCardFromCSVEdit()"></textarea>
                                        </div>
                                        
                                        <div style="margin-bottom: 12px;">
                                            <label for="csvEditContext" style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 4px;">å ´é¢ãƒ»çŠ¶æ³</label>
                                            <textarea id="csvEditContext" style="width: 100%; min-height: 40px; padding: 6px; font-size: 12px; border: 1px solid #ddd; border-radius: 4px; resize: vertical;" oninput="updateCardFromCSVEdit()"></textarea>
                                        </div>
                                        
                                        <div style="margin-bottom: 12px;">
                                            <label for="csvEditSolution" style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 4px;">å·¥å¤«ãƒ»ãƒˆãƒ©ã‚¤ã‚¢ãƒ«</label>
                                            <textarea id="csvEditSolution" style="width: 100%; min-height: 40px; padding: 6px; font-size: 12px; border: 1px solid #ddd; border-radius: 4px; resize: vertical;" oninput="updateCardFromCSVEdit()"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <h2 style="margin-bottom: 20px; color: #444;">ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚«ãƒ¼ãƒ‰ï¼ˆãƒ—ãƒªã‚»ãƒƒãƒˆåˆ†ï¼‰ä¸€æ‹¬ç”Ÿæˆ</h2>
                    
                    <!-- ãƒ—ãƒªã‚»ãƒƒãƒˆç‰ˆãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ–¹å¼é¸æŠ -->
                    <div id="presetDownloadMethodSection" style="margin-bottom: 15px; padding: 10px; background: #f8f9ff; border: 1px solid #e1e8ed; border-radius: 6px;">
                        <label style="font-size: 14px; color: #444; margin-bottom: 8px; display: block;">ğŸ“¦ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ–¹å¼:</label>
                        <div style="display: flex; gap: 15px; align-items: center;">
                            <label style="display: flex; align-items: center; cursor: pointer;">
                                <input type="radio" name="presetDownloadMethod" value="individual" checked 
                                       style="margin-right: 6px;">
                                <span style="font-size: 13px;">å€‹åˆ¥ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</span>
                            </label>
                            <label style="display: flex; align-items: center; cursor: pointer;">
                                <input type="radio" name="presetDownloadMethod" value="zip" 
                                       style="margin-right: 6px;">
                                <span style="font-size: 13px;">ZIPä¸€æ‹¬ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="batch-controls">
                        <button class="btn btn-secondary" onclick="selectAllPatterns()">
                            âœ… å…¨é¸æŠ
                        </button>
                        <button class="btn btn-secondary" onclick="clearSelection()">
                            âŒ é¸æŠè§£é™¤
                        </button>
                        <button class="btn btn-primary" onclick="generateBatch()" id="generateBatchBtn">
                            ğŸ¨ é¸æŠã—ãŸã‚«ãƒ¼ãƒ‰ã‚’ä¸€æ‹¬ç”Ÿæˆ
                        </button>
                    </div>
                    
                    <!-- ãƒ—ãƒªã‚»ãƒƒãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³å°‚ç”¨ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ -->
                    <div class="progress-bar" id="presetProgressBar" style="display: none;">
                        <div class="progress-fill" id="presetProgressFill"></div>
                    </div>
                    
                    <div class="pattern-grid" id="patternGrid">
                        <!-- ãƒ‘ã‚¿ãƒ¼ãƒ³é¸æŠé …ç›®ã¯ JavaScript ã§ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let canvas;
        let currentTemplate = 'academic';
        let selectedPatterns = new Set();
        let customBackgroundImage = null;
        let csvData = []; // CSVèª­ã¿è¾¼ã¿ãƒ‡ãƒ¼ã‚¿
        let currentFont = 'hiragino'; // é¸æŠä¸­ã®ãƒ•ã‚©ãƒ³ãƒˆ
        
        // ä¸­è§£åƒåº¦ã«å›ºå®šï¼ˆ888Ã—600pxï¼‰
        const baseWidth = 888;
        const baseHeight = 600;
        
        // æ–‡å­—å¹…è¨ˆç®—ãƒ»æ”¹è¡Œæ©Ÿèƒ½
        function isFullWidth(char) {
            // å…¨è§’æ–‡å­—åˆ¤å®šï¼ˆã²ã‚‰ãŒãªã€ã‚«ã‚¿ã‚«ãƒŠã€æ¼¢å­—ã€å…¨è§’è¨˜å·ç­‰ï¼‰
            const code = char.charCodeAt(0);
            return (code >= 0x3000 && code <= 0x9FAF) || // CJKçµ±åˆæ¼¢å­—ã€ã²ã‚‰ãŒãªã€ã‚«ã‚¿ã‚«ãƒŠ
                   (code >= 0xFF01 && code <= 0xFF60) || // å…¨è§’ASCII
                   (code >= 0xFFE0 && code <= 0xFFE6);   // å…¨è§’è¨˜å·
        }
        
        function insertLineBreaks(text, maxFullWidthChars = 36) {
            if (!text) return text;

            const maxHalfWidthChars = maxFullWidthChars * 2; // 36 * 2 = 72
            const chars = Array.from(text); // Unicodeå¯¾å¿œ
            let result = '';
            let lineLength = 0;
            
            for (let i = 0; i < chars.length; i++) {
                const char = chars[i];
                const charWidth = isFullWidth(char) ? 2 : 1;
                
                // æ”¹è¡Œæ–‡å­—ã®å ´åˆã¯ãƒªã‚»ãƒƒãƒˆ
                if (char === '\n') {
                    result += char;
                    lineLength = 0;
                    continue;
                }
                
                // è¡Œã®é•·ã•ãŒåˆ¶é™ã‚’è¶…ãˆã‚‹å ´åˆã¯æ”¹è¡Œ
                if (lineLength + charWidth > maxHalfWidthChars && lineLength > 0) {
                    result += '\n';
                    lineLength = 0;
                }
                
                result += char;
                lineLength += charWidth;
            }
            
            return result;
        }
        
        // ãƒ•ã‚©ãƒ³ãƒˆå®šç¾©
        const fontDefinitions = {
            hiragino: {
                name: 'ãƒ’ãƒ©ã‚®ãƒè§’ã‚´ ProN',
                family: "'ãƒ’ãƒ©ã‚®ãƒè§’ã‚´ ProN', 'Hiragino Kaku Gothic ProN', 'æ¸¸ã‚´ã‚·ãƒƒã‚¯', YuGothic, sans-serif",
                webFont: null
            },
            yugothic: {
                name: 'æ¸¸ã‚´ã‚·ãƒƒã‚¯',
                family: "'æ¸¸ã‚´ã‚·ãƒƒã‚¯', YuGothic, 'ãƒ’ãƒ©ã‚®ãƒè§’ã‚´ ProN', sans-serif",
                webFont: null
            },
            noto: {
                name: 'Noto Sans JP',
                family: "'Noto Sans JP', sans-serif",
                webFont: 'https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap'
            },
            arial: {
                name: 'Arial',
                family: "Arial, 'Helvetica Neue', Helvetica, sans-serif",
                webFont: null
            },
            roboto: {
                name: 'Roboto',
                family: "'Roboto', Arial, sans-serif",
                webFont: 'https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap'
            },
            opensans: {
                name: 'Open Sans',
                family: "'Open Sans', Arial, sans-serif",
                webFont: 'https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;700&display=swap'
            },
            comic: {
                name: 'ã‚³ãƒŸãƒƒã‚¯é¢¨',
                family: "'Comic Sans MS', 'Kosugi Maru', cursive, sans-serif",
                webFont: 'https://fonts.googleapis.com/css2?family=Kosugi+Maru&display=swap'
            },
            serif: {
                name: 'æ˜æœä½“',
                family: "'Times New Roman', 'ãƒ’ãƒ©ã‚®ãƒæ˜æœ ProN', 'Hiragino Mincho ProN', 'æ¸¸æ˜æœ', YuMincho, serif",
                webFont: null
            }
        };
        
        // ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ‡ãƒ¼ã‚¿ï¼ˆäº•åº­å´‡ã®40å€‹ã®ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ»ãƒ‘ã‚¿ãƒ¼ãƒ³å®Œå…¨ç‰ˆï¼‰
        const patternData = {
            0: { title: "å­¦ç¿’ã‚’ãƒ‡ã‚¶ã‚¤ãƒ³ã™ã‚‹", description: "è‡ªåˆ†ãªã‚Šã®å­¦ç¿’æ–¹æ³•ã‚’ãƒ‡ã‚¶ã‚¤ãƒ³ã—ã€å‰µé€ çš„ãªå­¦ç¿’ã‚’å®Ÿç¾ã™ã‚‹ã€‚", context: "å­¦ç¿’ã‚’å§‹ã‚ã‚‹ã¨ãã€æ–°ã—ã„åˆ†é‡ã‚’å­¦ç¿’ã™ã‚‹ã¨ãã€‚", solution: "å­¦ç¿’ç›®æ¨™ã‚’æ˜ç¢ºã«ã—ã€è‡ªåˆ†ã«åˆã£ãŸå­¦ç¿’ã‚¹ã‚¿ã‚¤ãƒ«ã‚’è¨­è¨ˆã™ã‚‹ã€‚" },
            1: { title: "æ©Ÿä¼šã‚’ã¤ãã‚‹", description: "å­¦ç¿’ã®æ©Ÿä¼šã‚’ç©æ¥µçš„ã«å‰µã‚Šå‡ºã—ã€å­¦ã³ã®ãã£ã‹ã‘ã‚’å¢—ã‚„ã™ã€‚", context: "å­¦ç¿’æ©Ÿä¼šãŒå°‘ãªã„ã¨æ„Ÿã˜ã‚‹ã¨ãã€‚", solution: "ç’°å¢ƒã‚„äººã¨ã®é–¢ã‚ã‚Šã‚’é€šã˜ã¦ã€æ–°ã—ã„å­¦ç¿’æ©Ÿä¼šã‚’ä½œã‚Šå‡ºã™ã€‚" },
            2: { title: "å‰µé€ çš„ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ", description: "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é€šã˜ãŸå®Ÿè·µçš„ã§å‰µé€ çš„ãªå­¦ç¿’ã‚’è¡Œã†ã€‚", context: "å®Ÿè·µçš„ãªã‚¹ã‚­ãƒ«ã‚’èº«ã«ã¤ã‘ãŸã„ã¨ãã€‚", solution: "å…·ä½“çš„ãªã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆã‚’ç›®æ¨™ã«ã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«å–ã‚Šçµ„ã‚€ã€‚" },
            3: { title: "ã‚ªãƒ¼ãƒ—ãƒ³ãƒ—ãƒ­ã‚»ã‚¹ãªå­¦ã³", description: "å­¦ç¿’ãƒ—ãƒ­ã‚»ã‚¹ã‚’ã‚ªãƒ¼ãƒ—ãƒ³ã«ã—ã€ä»–è€…ã¨å…±æœ‰ã—ãªãŒã‚‰å­¦ã¶ã€‚", context: "ä¸€äººã§å­¦ç¿’ã—ã¦ã„ã¦è¡Œãè©°ã¾ã‚Šã‚’æ„Ÿã˜ã‚‹ã¨ãã€‚", solution: "å­¦ç¿’éç¨‹ã‚’å¯è¦–åŒ–ã—ã€ä»–è€…ã¨ã®å¯¾è©±ã‚’é€šã˜ã¦å­¦ã³ã‚’æ·±ã‚ã‚‹ã€‚" },
            4: { title: "ã¾ãšã¯ã¤ã‹ã‚‹", description: "å®Œç’§ã‚’æ±‚ã‚ãšã€ã¾ãšã¯é£›ã³è¾¼ã‚“ã§ä½“é¨“ã‹ã‚‰å­¦ã¶ã€‚", context: "æ–°ã—ã„ã“ã¨ã‚’å§‹ã‚ã‚‹éš›ã«èºŠèº‡ã—ã¦ã—ã¾ã†ã¨ãã€‚", solution: "æº–å‚™ã‚ˆã‚Šã‚‚ã¾ãšè¡Œå‹•ã—ã€ä½“é¨“ã‚’é€šã˜ã¦å­¦ç¿’ã‚’é–‹å§‹ã™ã‚‹ã€‚" },
            5: { title: "è¦‹ã¾ã­å­¦ç¿’", description: "å„ªã‚ŒãŸäº‹ä¾‹ã‚’æ¨¡å€£ã™ã‚‹ã“ã¨ã‹ã‚‰å­¦ç¿’ã‚’å§‹ã‚ã‚‹ã€‚", context: "ä½•ã‹ã‚‰å§‹ã‚ã‚Œã°ã‚ˆã„ã‹ã‚ã‹ã‚‰ãªã„ã¨ãã€‚", solution: "ç†Ÿç·´è€…ã®è¡Œå‹•ã‚’è¦³å¯Ÿã—ã€ã¾ãšã¯çœŸä¼¼ã™ã‚‹ã“ã¨ã‹ã‚‰å§‹ã‚ã‚‹ã€‚" },
            6: { title: "åŠ¹æœçš„ãªè³ªå•", description: "é©åˆ‡ãªè³ªå•ã‚’é€šã˜ã¦å­¦ç¿’ã‚’æ·±åŒ–ã•ã›ã€æ–°ã—ã„æ´å¯Ÿã‚’å¾—ã‚‹ã€‚", context: "ç†è§£ãŒè¡¨é¢çš„ã«ç•™ã¾ã£ã¦ã„ã‚‹ã¨ãã€å­¦ã³ã‚’æ·±ã‚ãŸã„ã¨ãã€‚", solution: "æ ¸å¿ƒã‚’çªãè³ªå•ã‚’æŠ•ã’ã‹ã‘ã€è€ƒãˆã‚’æ•´ç†ã—ç†è§£ã‚’æ·±ã‚ã‚‹ã€‚" },
            7: { title: "ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆå¿—å‘ã®å­¦ç¿’", description: "ä½•ã‹ã‚’ä½œã‚Šå‡ºã™ã“ã¨ã‚’é€šã˜ã¦çŸ¥è­˜ã¨ã‚¹ã‚­ãƒ«ã‚’å‘ä¸Šã•ã›ã‚‹ã€‚", context: "å‹‰å¼·æ™‚ã€ã‚¯ãƒ©ã‚¹é¸æŠæ™‚ã€æ–°ã—ã„ã‚¹ã‚­ãƒ«ã‚’å­¦ã³ãŸã„ã¨ãã€‚", solution: "ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆã‚’ä½œã‚‹ã“ã¨ã‚’ç›®æ¨™ã«å­¦ç¿’ã—ã€ãƒ—ãƒ­ã‚»ã‚¹ã§ã‚¹ã‚­ãƒ«ã‚’å‘ä¸Šã•ã›ã‚‹ã€‚" },
            8: { title: "æ¯æ—¥å¤–å›½èª", description: "å¤–å›½èªå­¦ç¿’ã‚’æ—¥å¸¸çš„ãªç¿’æ…£ã«ã—ã¦ç¶™ç¶šçš„ã«ã‚¹ã‚­ãƒ«ã‚’å‘ä¸Šã•ã›ã‚‹ã€‚", context: "å¤–å›½èªã‚’ç¿’å¾—ã—ãŸã„ã¨ãã€èªå­¦ã‚¹ã‚­ãƒ«ã‚’ç¶­æŒã—ãŸã„ã¨ãã€‚", solution: "æ¯æ—¥å°‘ã—ãšã¤ã§ã‚‚å¤–å›½èªã«è§¦ã‚Œã‚‹ç’°å¢ƒã‚’ä½œã‚Šã€ç¶™ç¶šçš„ã«å­¦ç¿’ã™ã‚‹ã€‚" },
            9: { title: "éŠã³å¿ƒã®ã‚ã‚‹å­¦ç¿’", description: "æ¥½ã—ã¿ãªãŒã‚‰å­¦ã¶ã“ã¨ã§ã€å­¦ç¿’ã®åŠ¹æœã¨æŒç¶šæ€§ã‚’é«˜ã‚ã‚‹ã€‚", context: "å­¦ç¿’ãŒé€€å±ˆã«æ„Ÿã˜ã‚‹ã¨ãã€ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ãŒä½ä¸‹ã—ãŸã¨ãã€‚", solution: "ã‚²ãƒ¼ãƒ è¦ç´ ã‚„æ¥½ã—ã„è¦ç´ ã‚’å–ã‚Šå…¥ã‚Œã¦å­¦ç¿’ã«éŠã³å¿ƒã‚’æŒãŸã›ã‚‹ã€‚" },
            10: { title: "èº«ä½“åŒ–ã•ã‚ŒãŸã‚¹ã‚­ãƒ«", description: "èº«ä½“çš„ãªä½“é¨“ã‚’é€šã˜ã¦ã‚¹ã‚­ãƒ«ã‚’ç¿’å¾—ã—ã€æ·±ãèº«ã«ä»˜ã‘ã‚‹ã€‚", context: "å®Ÿè·µçš„ãªã‚¹ã‚­ãƒ«ã‚’èº«ã«ã¤ã‘ãŸã„ã¨ãã€ç†è«–ã ã‘ã§ã¯ä¸ååˆ†ãªã¨ãã€‚", solution: "å®Ÿéš›ã«æ‰‹ã‚’å‹•ã‹ã—ã€èº«ä½“çš„ãªä½“é¨“ã‚’é€šã˜ã¦ã‚¹ã‚­ãƒ«ã‚’ç¿’å¾—ã™ã‚‹ã€‚" },
            11: { title: "è¨€è‘‰ã®ã‚·ãƒ£ãƒ¯ãƒ¼", description: "å¤§é‡ã®æƒ…å ±ã«ç©æ¥µçš„ã«è§¦ã‚Œã‚‹ã“ã¨ã§ã€çŸ¥è­˜ã®åŸºç›¤ã‚’æ§‹ç¯‰ã™ã‚‹ã€‚", context: "æ–°ã—ã„åˆ†é‡ã®åŸºç¤çŸ¥è­˜ã‚’èº«ã«ã¤ã‘ãŸã„ã¨ãã€‚", solution: "é–¢é€£ã™ã‚‹æƒ…å ±ã«ç©æ¥µçš„ã«æµ¸ã‚Šã€çŸ¥è­˜ã®ãƒ™ãƒ¼ã‚¹ã‚’åºƒã’ã‚‹ã€‚" },
            12: { title: "æœ‰å½¢ã®è“„ç©", description: "å­¦ç¿’ã®æˆæœã‚’å…·ä½“çš„ãªå½¢ã§è“„ç©ã—ã€æˆé•·ã‚’å¯è¦–åŒ–ã™ã‚‹ã€‚", context: "å­¦ç¿’ã®é€²æ­©ãŒè¦‹ãˆã«ãã„ã¨ãã€ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä¿ã¡ãŸã„ã¨ãã€‚", solution: "å­¦ç¿’æˆæœã‚’ç‰©ç†çš„ãªå½¢ã§æ®‹ã—ã€ç©ã¿é‡ã­ã‚’å®Ÿæ„Ÿã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚" },
            13: { title: "å­¦ç¿’ã®ç«œå·»", description: "èˆˆå‘³ã¨é–¢é€£ã—ã¦çŸ¥è­˜ã‚’ç©æ¥µçš„ã«ã¤ã‹ã¿ã€å­¦ç¿’ã«å‹¢ã„ã‚’ã¤ã‘ã‚‹ã€‚", context: "å‹‰å¼·ã€èª­æ›¸ã€ç ”ç©¶ã‚’è¡Œã†æ™‚ã€è‡ªåˆ†ãªã‚Šã®æ–¹æ³•ã§ã‚„ã‚ŠãŸã„æ™‚ã€‚", solution: "èˆˆå‘³ã«åˆã£ãŸå­¦ç¿’ã‚’é¸ã³ã€æƒ…å ±ã‚’ç©æ¥µçš„ã«ã¤ã‹ã‚“ã§çŸ¥è­˜ã‚’æ··åˆã™ã‚‹ã€‚" },
            14: { title: "ä¸‰è§’ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°", description: "æ®µéšçš„ã«ãƒ¬ãƒ™ãƒ«ã‚’ä¸Šã’ãªãŒã‚‰å­¦ç¿’ã—ã€ç€å®Ÿã«ã‚¹ã‚­ãƒ«ã‚¢ãƒƒãƒ—ã™ã‚‹ã€‚", context: "è¤‡é›‘ãªã‚¹ã‚­ãƒ«ã‚’èº«ã«ã¤ã‘ãŸã„ã¨ãã€æ®µéšçš„æˆé•·ã‚’æ±‚ã‚ã‚‹ã¨ãã€‚", solution: "åŸºç¤ã‹ã‚‰å¿œç”¨ã¸ã¨ä¸‰è§’å½¢ã®ã‚ˆã†ã«æ®µéšçš„ã«å­¦ç¿’ç¯„å›²ã‚’æ‹¡å¤§ã™ã‚‹ã€‚" },
            15: { title: "èˆˆå¥®ã®é€£é–ï¼", description: "å­¦ç¿’ã¸ã®èˆˆå¥®ã‚’é€£é–ã•ã›ã€ç¶™ç¶šçš„ãªå­¦ç¿’æ„æ¬²ã‚’ç¶­æŒã™ã‚‹ã€‚", context: "å­¦ç¿’ã®ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é«˜ã‚ãŸã„ã¨ãã€ç†±æ„ã‚’æŒç¶šã•ã›ãŸã„ã¨ãã€‚", solution: "ä¸€ã¤ã®å­¦ã³ã®èˆˆå¥®ã‚’æ¬¡ã®å­¦ç¿’ã«ã¤ãªã’ã€é€£é–çš„ã«å­¦ç¿’æ„æ¬²ã‚’é«˜ã‚ã‚‹ã€‚" },
            16: { title: "è¡Œå‹•ã®ä¸­ã§ã®æ€è€ƒ", description: "å®Ÿéš›ã«è¡Œå‹•ã—ãªãŒã‚‰æ€è€ƒã—ã€å®Ÿè·µçš„ãªç†è§£ã‚’æ·±ã‚ã‚‹ã€‚", context: "ç†è«–ã ã‘ã§ã¯ç†è§£ãŒé€²ã¾ãªã„ã¨ãã€å®Ÿè·µçš„æ€è€ƒåŠ›ã‚’é¤Šã„ãŸã„ã¨ãã€‚", solution: "è¡Œå‹•ã¨æ€è€ƒã‚’åŒæ™‚ã«è¡Œã„ã€å®Ÿè·µã®ä¸­ã§ç†è§£ã‚’æ·±ã‚ã‚‹ã€‚" },
            17: { title: "ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ”ãƒ³ã‚°", description: "è©¦ä½œå“ã‚„åŸå‹ã‚’ä½œã‚‹ã“ã¨ã§å­¦ç¿’ã—ã€æ”¹å–„ã‚’é‡ã­ã‚‹ã€‚", context: "æ–°ã—ã„ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’å½¢ã«ã—ãŸã„ã¨ãã€å®Ÿè·µçš„ã«å­¦ã³ãŸã„ã¨ãã€‚", solution: "ã¾ãšç°¡å˜ãªåŸå‹ã‚’ä½œã‚Šã€è©¦è¡ŒéŒ¯èª¤ã‚’é€šã˜ã¦ç†è§£ã¨æŠ€è¡“ã‚’å‘ä¸Šã•ã›ã‚‹ã€‚" },
            18: { title: "ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒ€ã‚¤ãƒ“ãƒ³ã‚°", description: "å®Ÿéš›ã®ç¾å ´ã«æ·±ãé£›ã³è¾¼ã‚“ã§ã€ç”ŸããŸçŸ¥è­˜ã‚’ç²å¾—ã™ã‚‹ã€‚", context: "ç†è«–ã¨å®Ÿè·µã®ã‚®ãƒ£ãƒƒãƒ—ã‚’åŸ‹ã‚ãŸã„ã¨ãã€ãƒªã‚¢ãƒ«ãªä½“é¨“ã‚’æ±‚ã‚ã‚‹ã¨ãã€‚", solution: "å®Ÿéš›ã®ç¾å ´ã‚„ç’°å¢ƒã«èº«ã‚’ç½®ãã€ç”Ÿã®ä½“é¨“ã‹ã‚‰å­¦ç¿’ã™ã‚‹ã€‚" },
            19: { title: "ãƒãƒ«ãƒã‚«ãƒ¡ãƒ©æ’®å½±", description: "è¤‡æ•°ã®è¦–ç‚¹ã‹ã‚‰ç‰©äº‹ã‚’æ‰ãˆã€å¤šè§’çš„ãªç†è§£ã‚’å¾—ã‚‹ã€‚", context: "ä¸€ã¤ã®è¦–ç‚¹ã ã‘ã§ã¯ç†è§£ãŒé™å®šçš„ãªã¨ãã€åŒ…æ‹¬çš„ç†è§£ã‚’æ±‚ã‚ã‚‹ã¨ãã€‚", solution: "ç•°ãªã‚‹è§’åº¦ã‚„ç«‹å ´ã‹ã‚‰åŒã˜äº‹è±¡ã‚’è¦³å¯Ÿã—ã€å¤šé¢çš„ã«ç†è§£ã™ã‚‹ã€‚" },
            20: { title: "é³¥ã®ç›®ãƒ»è™«ã®ç›®", description: "å¤§å±€çš„è¦–ç‚¹ã¨è©³ç´°ãªè¦–ç‚¹ã‚’ä½¿ã„åˆ†ã‘ã¦ã€ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸç†è§£ã‚’å¾—ã‚‹ã€‚", context: "å…¨ä½“åƒãŒè¦‹ãˆãªã„ã¨ãã€ã¾ãŸã¯è©³ç´°ãŒè¦‹è½ã¨ã•ã‚ŒãŒã¡ãªã¨ãã€‚", solution: "ãƒã‚¯ãƒ­ã¨ãƒŸã‚¯ãƒ­ã®è¦–ç‚¹ã‚’æ„è­˜çš„ã«åˆ‡ã‚Šæ›¿ãˆã¦å­¦ç¿’ã™ã‚‹ã€‚" },
            21: { title: "éš ã‚ŒãŸã¤ãªãŒã‚Š", description: "ä¸€è¦‹é–¢ä¿‚ã®ãªã„ç‰©äº‹é–“ã®éš ã‚ŒãŸé–¢é€£æ€§ã‚’ç™ºè¦‹ã—ã€æ–°ãŸãªæ´å¯Ÿã‚’å¾—ã‚‹ã€‚", context: "å‹‰å¼·ã€ç ”ç©¶ã€èª­æ›¸ã€æ–°ã—ã„è¦–ç‚¹ãŒå¿…è¦ãªæ™‚ã€ã‚¯ãƒ©ã‚¹é¸æŠæ™‚ã€‚", solution: "å­¦å•åˆ†é‡ã‚’è¶…ãˆãŸå…±é€šã®è¨€è‘‰ã‚„ç ”ç©¶è€…ã‚’é€šã˜ã¦ã¤ãªãŒã‚Šã‚’è¦‹ã¤ã‘ã‚‹ã€‚" },
            22: { title: "ãƒ•ãƒ­ãƒ³ãƒ†ã‚£ã‚¢ç™ºè¦‹è€…", description: "æœªé–‹æ‹“ã®é ˜åŸŸã‚„æ–°ã—ã„å¯èƒ½æ€§ã‚’ç©æ¥µçš„ã«æ¢æ±‚ã™ã‚‹ã€‚", context: "æ–°ã—ã„åˆ†é‡ã‚’é–‹æ‹“ã—ãŸã„ã¨ãã€ã‚¤ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ±‚ã‚ã‚‹ã¨ãã€‚", solution: "æ—¢å­˜ã®æ ã‚’è¶…ãˆã¦æ–°ã—ã„é ˜åŸŸã‚’æ¢æ±‚ã—ã€ãƒ•ãƒ­ãƒ³ãƒ†ã‚£ã‚¢ã‚’é–‹æ‹“ã™ã‚‹ã€‚" },
            23: { title: "å‰µé€ çš„ã‚¹ã‚¤ãƒƒãƒ", description: "å‰µé€ æ€§ã‚’ç™ºæ®ã™ã‚‹ãŸã‚ã®ã‚¹ã‚¤ãƒƒãƒã‚’æ„è­˜çš„ã«åˆ‡ã‚Šæ›¿ãˆã‚‹ã€‚", context: "ã‚¢ã‚¤ãƒ‡ã‚¢ãŒå‡ºãªã„ã¨ãã€å‰µé€ çš„æ€è€ƒãŒå¿…è¦ãªã¨ãã€‚", solution: "ç’°å¢ƒã‚„æ€è€ƒãƒ¢ãƒ¼ãƒ‰ã‚’æ„è­˜çš„ã«å¤‰ãˆã¦å‰µé€ æ€§ã‚’åˆºæ¿€ã™ã‚‹ã€‚" },
            24: { title: "æœç‰©è¾²æ¥­", description: "é•·æœŸçš„ãªè¦–ç‚¹ã§å­¦ç¿’ã‚’è‚²ã¦ã€æ™‚é–“ã‚’ã‹ã‘ã¦æˆæœã‚’åç©«ã™ã‚‹ã€‚", context: "å³åº§ã®æˆæœãŒè¦‹ãˆã«ãã„é•·æœŸçš„å­¦ç¿’ã«å–ã‚Šçµ„ã‚€ã¨ãã€‚", solution: "æ¤ç‰©ã‚’è‚²ã¦ã‚‹ã‚ˆã†ã«ã€æ™‚é–“ã‚’ã‹ã‘ã¦å­¦ç¿’ã‚’è‚²ã¦ã€æˆæœã‚’å¾…ã¤ã€‚" },
            25: { title: "åˆç¨¿ã¯é“åŠã°", description: "å®Œç’§ã‚’æ±‚ã‚ãšã«æœ€åˆã®ç‰ˆã‚’ä½œã‚Šã€æ”¹å–„ã‚’é‡ã­ã‚‹ã€‚", context: "å®Œç’§ä¸»ç¾©ã§å‰ã«é€²ã‚ãªã„ã¨ãã€ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆã‚’å‡ºã—ãŸã„ã¨ãã€‚", solution: "ã¾ãšä¸å®Œå…¨ã§ã‚‚å½¢ã«ã—ã€ãã®å¾Œæ”¹å–„ã‚’é‡ã­ã¦è³ªã‚’é«˜ã‚ã‚‹ã€‚" },
            26: { title: "é­…åŠ›çš„è¡¨ç¾", description: "å­¦ç¿’å†…å®¹ã‚’é­…åŠ›çš„ã«è¡¨ç¾ã—ã€ä»–è€…ã¨ã®å…±æœ‰ã‚’ä¿ƒé€²ã™ã‚‹ã€‚", context: "å­¦ç¿’å†…å®¹ã‚’ä»–è€…ã«ä¼ãˆãŸã„ã¨ãã€è¡¨ç¾åŠ›ã‚’é«˜ã‚ãŸã„ã¨ãã€‚", solution: "èãæ‰‹ã‚’æ„è­˜ã—ãŸé­…åŠ›çš„ãªè¡¨ç¾æ–¹æ³•ã‚’å·¥å¤«ã—ã€åŠ¹æœçš„ã«ä¼ãˆã‚‹ã€‚" },
            27: { title: "æ¬¡ã¸ã®åŠ é€Ÿ", description: "ä¸€æ®µéšã®å­¦ç¿’å®Œäº†ã‚’æ¬¡ã®å­¦ç¿’ã¸ã®æ¨é€²åŠ›ã«å¤‰ãˆã‚‹ã€‚", context: "å­¦ç¿’ã®åŒºåˆ‡ã‚ŠãŒã¤ã„ãŸã¨ãã€æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã«é€²ã¿ãŸã„ã¨ãã€‚", solution: "é”æˆæ„Ÿã‚’åŸå‹•åŠ›ã¨ã—ã¦ã€ã‚ˆã‚Šé«˜ã„ãƒ¬ãƒ™ãƒ«ã®å­¦ç¿’ã«æŒ‘æˆ¦ã™ã‚‹ã€‚" },
            28: { title: "å­¦ç¿’ã®ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£", description: "åŒã˜ç›®æ¨™ã‚’æŒã¤ä»²é–“ã¨ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚’å½¢æˆã—ã€å…±ã«å­¦ç¿’ã™ã‚‹ã€‚", context: "ä¸€äººã§ã®å­¦ç¿’ã«é™ç•Œã‚’æ„Ÿã˜ã‚‹ã¨ãã€ä»²é–“ã¨å­¦ã³ãŸã„ã¨ãã€‚", solution: "å­¦ç¿’ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚’å½¢æˆã—ã€ãƒ¡ãƒ³ãƒãƒ¼é–“ã§æ”¯æ´ã—åˆã„ãªãŒã‚‰å­¦ç¿’ã™ã‚‹ã€‚" },
            29: { title: "å¶ç„¶ã®å‡ºä¼šã„", description: "äºˆæœŸã—ãªã„å‡ºä¼šã„ã‚„ç™ºè¦‹ã‹ã‚‰å­¦ç¿’æ©Ÿä¼šã‚’å‰µã‚Šå‡ºã™ã€‚", context: "æ–°ã—ã„åˆºæ¿€ã‚„ç™ºè¦‹ã‚’æ±‚ã‚ã‚‹ã¨ãã€å­¦ç¿’ã®å¹…ã‚’åºƒã’ãŸã„ã¨ãã€‚", solution: "å¶ç„¶ã®å‡ºä¼šã„ã«å¿ƒã‚’é–‹ãã€ãã“ã‹ã‚‰å­¦ç¿’ã®ãã£ã‹ã‘ã‚’è¦‹ã¤ã‘ã‚‹ã€‚" },
            30: { title: "è‰¯ããƒ©ã‚¤ãƒãƒ«", description: "äº’ã„ã«é«˜ã‚åˆãˆã‚‹ç«¶äº‰ç›¸æ‰‹ã¨ã®é–¢ä¿‚ã‚’å­¦ç¿’ã«æ´»ç”¨ã™ã‚‹ã€‚", context: "å­¦ç¿’ã®ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é«˜ã‚ãŸã„ã¨ãã€åˆ‡ç£‹ç¢ç£¨ã—ãŸã„ã¨ãã€‚", solution: "è‰¯ã„ç«¶äº‰ç›¸æ‰‹ã‚’è¦‹ã¤ã‘ã€äº’ã„ã«åˆºæ¿€ã—åˆã„ãªãŒã‚‰æˆé•·ã™ã‚‹ã€‚" },
            31: { title: "è©±ã™æ€è€ƒè€…", description: "å£°ã«å‡ºã—ã¦è€ƒãˆã‚‹ã“ã¨ã§æ€è€ƒã‚’æ•´ç†ã—ã€ç†è§£ã‚’æ·±ã‚ã‚‹ã€‚", context: "è€ƒãˆãŒã¾ã¨ã¾ã‚‰ãªã„ã¨ãã€æ€è€ƒã‚’æ•´ç†ã—ãŸã„ã¨ãã€‚", solution: "è€ƒãˆã‚’å£°ã«å‡ºã—ã¦æ•´ç†ã—ã€å¯¾è©±ã‚’é€šã˜ã¦ç†è§£ã‚’æ·±ã‚ã‚‹ã€‚" },
            32: { title: "æ•™ãˆã‚‹ã“ã¨ã«ã‚ˆã‚‹å­¦ç¿’", description: "ä»–è€…ã«æ•™ãˆã‚‹ã“ã¨ã§è‡ªåˆ†ã®ç†è§£ã‚’æ·±ã‚ã€çŸ¥è­˜ã‚’å®šç€ã•ã›ã‚‹ã€‚", context: "çŸ¥è­˜ã‚’å®šç€ã•ã›ãŸã„ã¨ãã€ç†è§£ã®æ·±åŒ–ã‚’å›³ã‚ŠãŸã„ã¨ãã€‚", solution: "å­¦ã‚“ã ã“ã¨ã‚’ä»–è€…ã«æ•™ãˆã‚‹æ©Ÿä¼šã‚’ä½œã‚Šã€æ•™ãˆã‚‹éç¨‹ã§å­¦ç¿’ã™ã‚‹ã€‚" },
            33: { title: "ç¢ºå›ºãŸã‚‹æ±ºæ„", description: "æ˜ç¢ºãªæ„å¿—ã‚’æŒã£ã¦å­¦ç¿’ã«å–ã‚Šçµ„ã¿ã€å›°é›£ã‚’ä¹—ã‚Šè¶Šãˆã‚‹ã€‚", context: "å›°é›£ãªå­¦ç¿’ã«æŒ‘æˆ¦ã™ã‚‹ã¨ãã€æ„å¿—ã‚’å¼·ãæŒã¡ãŸã„ã¨ãã€‚", solution: "å­¦ç¿’ã¸ã®å¼·ã„æ±ºæ„ã‚’æŒã¡ã€ç›®æ¨™é”æˆã¾ã§è«¦ã‚ãšã«å–ã‚Šçµ„ã‚€ã€‚" },
            34: { title: "ç–‘å•ã‚’æŒã¤å¿ƒ", description: "å¸¸ã«ç–‘å•ã‚’æŒã¡ç¶šã‘ã€æ‰¹åˆ¤çš„æ€è€ƒã§å­¦ç¿’ã‚’æ·±ã‚ã‚‹ã€‚", context: "å—å‹•çš„ãªå­¦ç¿’ã«ãªã£ã¦ã„ã‚‹ã¨ãã€æ‰¹åˆ¤çš„æ€è€ƒåŠ›ã‚’é¤Šã„ãŸã„ã¨ãã€‚", solution: "ä¸ãˆã‚‰ã‚ŒãŸæƒ…å ±ã«ç–‘å•ã‚’æŒã¡ã€è‡ªåˆ†ãªã‚Šã«è€ƒãˆæŠœãå§¿å‹¢ã‚’ä¿ã¤ã€‚" },
            35: { title: "æ­£ã—ã„æ–¹æ³•", description: "åŠ¹æœçš„ã§æ­£ç¢ºãªå­¦ç¿’æ–¹æ³•ã‚’è¦‹ã¤ã‘ã€è³ªã®é«˜ã„å­¦ç¿’ã‚’å®Ÿç¾ã™ã‚‹ã€‚", context: "å­¦ç¿’åŠ¹ç‡ã‚’ä¸Šã’ãŸã„ã¨ãã€æ­£ç¢ºãªçŸ¥è­˜ã‚’èº«ã«ã¤ã‘ãŸã„ã¨ãã€‚", solution: "æ¤œè¨¼æ¸ˆã¿ã®åŠ¹æœçš„ãªå­¦ç¿’æ–¹æ³•ã‚’æ¡ç”¨ã—ã€è³ªã®é«˜ã„å­¦ç¿’ã‚’è¡Œã†ã€‚" },
            36: { title: "å‹‡æ•¢ãªå¤‰åŒ–", description: "æ—¢å­˜ã®æ–¹æ³•ã«å›ºåŸ·ã›ãšã€å‹‡æ°—ã‚’æŒã£ã¦æ–°ã—ã„å­¦ç¿’æ³•ã«æŒ‘æˆ¦ã™ã‚‹ã€‚", context: "å­¦ç¿’æ–¹æ³•ã‚’å¤‰ãˆã‚‹å¿…è¦ãŒã‚ã‚‹ã¨ãã€æ–°ã—ã„æŒ‘æˆ¦ã‚’ã—ãŸã„ã¨ãã€‚", solution: "ç¾çŠ¶ã«æº€è¶³ã›ãšã€å‹‡æ°—ã‚’æŒã£ã¦æ–°ã—ã„å­¦ç¿’æ–¹æ³•ã«æŒ‘æˆ¦ã™ã‚‹ã€‚" },
            37: { title: "æ¢æ¤œå®¶ã®æƒ…ç†±", description: "æœªçŸ¥ã®é ˜åŸŸã¸ã®æ¢æ±‚å¿ƒã‚’æŒã¡ç¶šã‘ã€å­¦ç¿’ã¸ã®æƒ…ç†±ã‚’ç¶­æŒã™ã‚‹ã€‚", context: "å­¦ç¿’ã¸ã®æƒ…ç†±ã‚’ç¶­æŒã—ãŸã„ã¨ãã€æ¢æ±‚å¿ƒã‚’å¤±ã„ã‹ã‘ã¦ã„ã‚‹ã¨ãã€‚", solution: "æ¢æ¤œå®¶ã®ã‚ˆã†ãªæƒ…ç†±ã¨å¥½å¥‡å¿ƒã‚’æŒã¡ç¶šã‘ã€å­¦ç¿’ã«å–ã‚Šçµ„ã‚€ã€‚" },
            38: { title: "è‡ªå·±ãƒ—ãƒ­ãƒ‡ãƒ¥ãƒ¼ã‚µãƒ¼", description: "è‡ªåˆ†è‡ªèº«ã®å­¦ç¿’ã‚’ãƒ—ãƒ­ãƒ‡ãƒ¥ãƒ¼ã‚¹ã—ã€ä¸»ä½“çš„ã«å­¦ç¿’ç’°å¢ƒã‚’å‰µé€ ã™ã‚‹ã€‚", context: "ä¸»ä½“çš„ãªå­¦ç¿’ã‚’å®Ÿç¾ã—ãŸã„ã¨ãã€å­¦ç¿’ç’°å¢ƒã‚’æ”¹å–„ã—ãŸã„ã¨ãã€‚", solution: "è‡ªåˆ†ã®å­¦ç¿’ã‚’å®¢è¦³è¦–ã—ã€ãƒ—ãƒ­ãƒ‡ãƒ¥ãƒ¼ã‚µãƒ¼ã®è¦–ç‚¹ã§æœ€é©åŒ–ã™ã‚‹ã€‚" },
            39: { title: "æ¥µç«¯ã«ãªã‚Œï¼", description: "æ™‚ã«ã¯æ¥µç«¯ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’å–ã‚Šã€å¾“æ¥ã®æ ã‚’ç ´ã£ã¦å­¦ç¿’ã™ã‚‹ã€‚", context: "å¾“æ¥ã®æ–¹æ³•ã§ã¯æˆæœãŒå‡ºãªã„ã¨ãã€ãƒ–ãƒ¬ã‚¤ã‚¯ã‚¹ãƒ«ãƒ¼ãŒå¿…è¦ãªã¨ãã€‚", solution: "å¸¸è­˜ã«ã¨ã‚‰ã‚ã‚Œãšã€æ™‚ã«ã¯æ¥µç«¯ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§å­¦ç¿’ã«å–ã‚Šçµ„ã‚€ã€‚" }
        };
        
        // CanvasåˆæœŸåŒ–
        function initCanvas() {
            try {
                const canvasElement = document.getElementById('cardCanvas');
                if (!canvasElement) {
                    console.error('Canvasè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    return;
                }
                
                // CanvasåˆæœŸåŒ–ï¼ˆ888Ã—600pxå›ºå®šï¼‰
                canvas = new fabric.Canvas('cardCanvas', {
                    width: baseWidth,
                    height: baseHeight,
                    backgroundColor: '#ffffff'
                });
                
                // è¡¨ç¤ºã‚µã‚¤ã‚ºã‚’888Ã—600pxã«å›ºå®š
                canvasElement.style.width = baseWidth + 'px';
                canvasElement.style.height = baseHeight + 'px';
                
                updateCard();
            } catch (error) {
                console.error('CanvasåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
                alert('CanvasåˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚');
            }
        }
        
        // 16é€²æ•°ã‚«ãƒ©ãƒ¼ã‚’RGBAã«å¤‰æ›ã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
        function hexToRgba(hex, alpha = 1) {
            // #ã‚’é™¤å»
            hex = hex.replace('#', '');
            
            // 3æ¡ã®å ´åˆã¯6æ¡ã«æ‹¡å¼µ
            if (hex.length === 3) {
                hex = hex.split('').map(char => char + char).join('');
            }
            
            // RGBã«å¤‰æ›
            const r = parseInt(hex.substr(0, 2), 16);
            const g = parseInt(hex.substr(2, 2), 16);
            const b = parseInt(hex.substr(4, 2), 16);
            
            return `rgba(${r}, ${g}, ${b}, ${alpha})`;
        }
        
        // è§£åƒåº¦æ›´æ–°ï¼ˆå›ºå®šã®ãŸã‚ç„¡åŠ¹åŒ–ï¼‰
        function updateResolution() {
            // ä¸­è§£åƒåº¦å›ºå®šã®ãŸã‚å‡¦ç†ãªã—
        }
        
        // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠ
        function selectTemplate(template) {
            document.querySelectorAll('.template-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[data-template="${template}"]`).classList.add('active');
            currentTemplate = template;
            
            // ã‚«ã‚¹ã‚¿ãƒ èƒŒæ™¯ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ¬„ã®è¡¨ç¤º/éè¡¨ç¤º
            const customGroup = document.getElementById('customBackgroundGroup');
            if (template === 'custom') {
                customGroup.style.display = 'block';
            } else {
                customGroup.style.display = 'none';
            }
            
            // ã‚«ã‚¹ã‚¿ãƒ ã‚«ãƒ©ãƒ¼ãŒæœ‰åŠ¹ãªå ´åˆã¯ç„¡åŠ¹åŒ–
            if (document.getElementById('enableCustomColors').checked) {
                document.getElementById('enableCustomColors').checked = false;
                toggleCustomColors();
            }
            
            updateCard();
        }

        // ã‚«ãƒ©ãƒ¼ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºæ©Ÿèƒ½
        let customColors = null;
        let savedPalettes = JSON.parse(localStorage.getItem('learning-pattern-palettes') || '[]');

        function toggleCustomColors() {
            const checkbox = document.getElementById('enableCustomColors');
            const panel = document.getElementById('customColorsPanel');
            const toggle = document.querySelector('.custom-color-toggle');
            
            if (checkbox.checked) {
                panel.style.display = 'block';
                toggle.classList.add('active');
                // ç¾åœ¨ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®è‰²ã‚’åˆæœŸå€¤ã¨ã—ã¦è¨­å®š
                const templateColors = {
                    academic: { primary: '#ffffff', secondary: '#d0d0d0', accent: '#ffffff' },
                    nature: { primary: '#259e56', secondary: '#f4f269', accent: '#ffffff' },
                    warm: { primary: '#fff95b', secondary: '#ff930f', accent: '#ffffff' },
                    elegant: { primary: '#d4af37', secondary: '#c0c0c0', accent: '#ffffff' },
                    pastel: { primary: '#e9e9b7', secondary: '#d3f3f1', accent: '#ffffff' },
                    spring: { primary: '#fce9d7', secondary: '#eed4e8', accent: '#ffffff' },
                    summer: { primary: '#f6f6f6', secondary: '#2c6cbc', accent: '#ffffff' },
                    autumn: { primary: '#fdd57e', secondary: '#924e8c', accent: '#ffffff' },
                    winter: { primary: '#f1f5f9', secondary: '#475569', accent: '#ffffff' },
                    custom: { primary: '#f5f5f5', secondary: '#e8e8e8', accent: '#ffffff' }
                };
                
                const colors = templateColors[currentTemplate] || templateColors.academic;
                document.getElementById('primaryColor').value = colors.primary;
                document.getElementById('secondaryColor').value = colors.secondary;
                document.getElementById('accentColor').value = colors.accent;
                updateCustomColors();
            } else {
                panel.style.display = 'none';
                toggle.classList.remove('active');
                customColors = null;
                updateCard();
            }
        }
        
        // UIç”¨ã®ãƒˆã‚°ãƒ«é–¢æ•°ï¼ˆãƒ©ãƒ™ãƒ«ã‚¯ãƒªãƒƒã‚¯å¯¾å¿œï¼‰
        function toggleCustomColorsUI() {
            const checkbox = document.getElementById('enableCustomColors');
            checkbox.checked = !checkbox.checked;
            toggleCustomColors();
        }

        function updateCustomColors() {
            customColors = {
                primary: document.getElementById('primaryColor').value,
                secondary: document.getElementById('secondaryColor').value,
                accent: document.getElementById('accentColor').value
            };
            updateCard();
        }

        function saveCustomPalette() {
            const nameInput = document.getElementById('paletteNameInput');
            const name = nameInput.value.trim();
            
            if (!name) {
                alert('ãƒ‘ãƒ¬ãƒƒãƒˆåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            if (!customColors) {
                alert('ã‚«ã‚¹ã‚¿ãƒ ã‚«ãƒ©ãƒ¼ã‚’è¨­å®šã—ã¦ãã ã•ã„');
                return;
            }
            
            if (savedPalettes.length >= 6) {
                alert('ãƒ‘ãƒ¬ãƒƒãƒˆã¯æœ€å¤§6å€‹ã¾ã§ä¿å­˜ã§ãã¾ã™');
                return;
            }
            
            if (savedPalettes.find(p => p.name === name)) {
                alert('åŒã˜åå‰ã®ãƒ‘ãƒ¬ãƒƒãƒˆãŒæ—¢ã«å­˜åœ¨ã—ã¾ã™');
                return;
            }
            
            savedPalettes.push({
                name: name,
                colors: { ...customColors }
            });
            
            localStorage.setItem('learning-pattern-palettes', JSON.stringify(savedPalettes));
            nameInput.value = '';
            renderSavedPalettes();
        }

        function loadCustomPalette(index) {
            const palette = savedPalettes[index];
            if (!palette) return;
            
            document.getElementById('enableCustomColors').checked = true;
            toggleCustomColors();
            
            document.getElementById('primaryColor').value = palette.colors.primary;
            document.getElementById('secondaryColor').value = palette.colors.secondary;
            document.getElementById('accentColor').value = palette.colors.accent;
            updateCustomColors();
        }

        function deleteCustomPalette(index) {
            if (confirm('ã“ã®ãƒ‘ãƒ¬ãƒƒãƒˆã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                savedPalettes.splice(index, 1);
                localStorage.setItem('learning-pattern-palettes', JSON.stringify(savedPalettes));
                renderSavedPalettes();
            }
        }

        function renderSavedPalettes() {
            const container = document.getElementById('savedPalettes');
            container.innerHTML = '';
            
            savedPalettes.forEach((palette, index) => {
                const div = document.createElement('div');
                div.className = 'saved-palette';
                div.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <span>${palette.name}</span>
                        <div class="palette-colors">
                            <div class="palette-color-dot" style="background: ${palette.colors.primary}"></div>
                            <div class="palette-color-dot" style="background: ${palette.colors.secondary}"></div>
                            <div class="palette-color-dot" style="background: ${palette.colors.accent}"></div>
                        </div>
                    </div>
                    <div class="palette-actions">
                        <button class="palette-action-btn" onclick="loadCustomPalette(${index})">é©ç”¨</button>
                        <button class="palette-action-btn" onclick="deleteCustomPalette(${index})">å‰Šé™¤</button>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        // åˆæœŸåŒ–æ™‚ã«ä¿å­˜æ¸ˆã¿ãƒ‘ãƒ¬ãƒƒãƒˆã‚’è¡¨ç¤º
        document.addEventListener('DOMContentLoaded', function() {
            renderSavedPalettes();
        });

        // èƒŒæ™¯ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å‡¦ç†
        function handleBackgroundUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                fabric.Image.fromURL(e.target.result, function(img) {
                    customBackgroundImage = img;
                    updateCard();
                });
            };
            reader.readAsDataURL(file);
        }
        
        // ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
        function loadPatternData() {
            const select = document.getElementById('patternSelect');
            const patternId = select.value;
            
            if (patternId && patternData[patternId]) {
                const data = patternData[patternId];
                document.getElementById('patternTitle').value = data.title;
                document.getElementById('patternDescription').value = data.description;
                document.getElementById('patternContext').value = data.context;
                document.getElementById('patternSolution').value = data.solution;
                updateCard();
            }
        }
        
        // ã‚«ãƒ¼ãƒ‰æ›´æ–°
        function updateCard() {
            if (!canvas) {
                console.warn('CanvasæœªåˆæœŸåŒ–ã®ãŸã‚ã€ã‚«ãƒ¼ãƒ‰æ›´æ–°ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã™');
                return;
            }
            
            try {
                const title = document.getElementById('patternTitle').value || 'ãƒ‘ã‚¿ãƒ¼ãƒ³å';
                const description = document.getElementById('patternDescription').value || '';
                const context = document.getElementById('patternContext').value || '';
                const solution = document.getElementById('patternSolution').value || '';
                const patternNumber = document.getElementById('patternSelect').value || '';
                
                canvas.clear();
                
                // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåˆ¥ã®è‰²è¨­å®šï¼ˆãƒ—ãƒªã‚»ãƒƒãƒˆæ‹¡å¼µï¼‰
                const templateColors = {
                    academic: { primary: '#ffffff', secondary: '#d0d0d0', accent: '#ffffff' },
                    nature: { primary: '#259e56', secondary: '#f4f269', accent: '#ffffff' },
                    warm: { primary: '#fff95b', secondary: '#ff930f', accent: '#ffffff' },
                    elegant: { primary: '#d4af37', secondary: '#c0c0c0', accent: '#ffffff' },
                    pastel: { primary: '#e9e9b7', secondary: '#d3f3f1', accent: '#ffffff' },
                    spring: { primary: '#fce9d7', secondary: '#eed4e8', accent: '#ffffff' },
                    summer: { primary: '#f6f6f6', secondary: '#2c6cbc', accent: '#ffffff' },
                    autumn: { primary: '#fdd57e', secondary: '#924e8c', accent: '#ffffff' },
                    winter: { primary: '#f1f5f9', secondary: '#475569', accent: '#ffffff' },
                    custom: { primary: '#f5f5f5', secondary: '#e8e8e8', accent: '#ffffff' }
                };
                
                // ã‚«ã‚¹ã‚¿ãƒ ã‚«ãƒ©ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã¯å„ªå…ˆä½¿ç”¨
                const colors = customColors || templateColors[currentTemplate] || templateColors.academic;
                
                // 888Ã—600pxå›ºå®šã‚µã‚¤ã‚º
                const width = baseWidth;
                const height = baseHeight;
            
            // èƒŒæ™¯ä½œæˆ
            let background;
            if (currentTemplate === 'custom' && customBackgroundImage) {
                // ã‚«ã‚¹ã‚¿ãƒ èƒŒæ™¯ç”»åƒã‚’ä½¿ç”¨
                background = fabric.util.object.clone(customBackgroundImage);
                background.set({
                    left: 0,
                    top: 0,
                    scaleX: width / background.width,
                    scaleY: height / background.height,
                    selectable: false
                });
            } else {
                // ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³èƒŒæ™¯
                const gradient = new fabric.Gradient({
                    type: 'linear',
                    coords: { x1: 0, y1: 0, x2: width, y2: height },
                    colorStops: [
                        { offset: 0, color: colors.primary },
                        { offset: 1, color: colors.secondary }
                    ]
                });
                
                background = new fabric.Rect({
                    left: 0,
                    top: 0,
                    width: width,
                    height: height,
                    fill: gradient,
                    selectable: false
                });
            }
            canvas.add(background);
            
            // ãƒ‘ã‚¿ãƒ¼ãƒ³ç•ªå·ï¼ˆå·¦ä¸Šï¼‰- 888Ã—600pxç”¨ã«ã‚µã‚¤ã‚ºèª¿æ•´ï¼ˆè¦‹å‡ºã—ã¨é«˜ã•çµ±ä¸€ã€é©åº¦ãªé–“éš”ç¢ºä¿ï¼‰
            if (patternNumber) {
                const numberCircle = new fabric.Circle({
                    left: 45,
                    top: 38,
                    radius: 30,
                    fill: colors.accent,
                    selectable: false
                });
                canvas.add(numberCircle);
                
                const numberText = new fabric.Text(patternNumber, {
                    left: 75,
                    top: 52,
                    fontSize: 32,
                    fill: '#333333',
                    fontFamily: getCurrentFontFamily(),
                    fontWeight: 'bold',
                    textAlign: 'center',
                    originX: 'center',
                    originY: 'top',
                    selectable: false
                });
                canvas.add(numberText);
            }
            
            // ã‚¿ã‚¤ãƒˆãƒ«èƒŒæ™¯ï¼ˆç™½ã„è§’ä¸¸ï¼‰- 888Ã—600pxç”¨ã«ã‚µã‚¤ã‚ºèª¿æ•´ï¼ˆç•ªå·ã¨é©åº¦ãªé–“éš”ã‚’ç¢ºä¿ï¼‰
            const titleWidth = patternNumber ? 728 : 798;
            const titleLeft = patternNumber ? 115 : 45;
            
            // æ›²ç·šçš„ãªé€æ˜åº¦å¤‰åŒ–ã‚’ä½œã‚‹ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆä¸­å¤®ã¾ã§ã¯ã‚†ã‚‹ã‚„ã‹ã€ãã®å¾Œæ€¥æ¿€ã«é€æ˜ã«ï¼‰
            const titleGradient = new fabric.Gradient({
                type: 'linear',
                coords: { x1: 0, y1: 0, x2: titleWidth, y2: 0 },
                colorStops: [
                    { offset: 0, color: hexToRgba(colors.accent, 0.9) },     // å·¦ç«¯ï¼š10%é€æ˜åº¦
                    { offset: 0.4, color: hexToRgba(colors.accent, 0.9) },   // 40%åœ°ç‚¹ï¼š10%é€æ˜åº¦
                    { offset: 0.6, color: hexToRgba(colors.accent, 0.8) },    // 60%åœ°ç‚¹ï¼š20%é€æ˜åº¦
                    { offset: 0.8, color: hexToRgba(colors.accent, 0.4) },    // 80%åœ°ç‚¹ï¼š60%é€æ˜åº¦
                    { offset: 1, color: hexToRgba(colors.accent, 0.0) }       // å³ç«¯ï¼šå®Œå…¨é€æ˜
                ]
            });
            
            const titleBg = new fabric.Rect({
                left: titleLeft,
                top: 38,
                width: titleWidth,
                height: 60,
                fill: titleGradient,
                rx: 12,
                ry: 12,
                shadow: {
                    color: 'rgba(0,0,0,0.1)',
                    blur: 15,
                    offsetX: 0,
                    offsetY: 3
                },
                selectable: false
            });
            canvas.add(titleBg);
            
            // ã‚¿ã‚¤ãƒˆãƒ« - 888Ã—600pxç”¨ã«ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºèª¿æ•´ï¼ˆã‚«ãƒ¼ãƒ‰ç•ªå·ã¨å‚ç›´ä½ç½®çµ±ä¸€ã€2pxä¸Šã«èª¿æ•´ï¼‰
            const titleText = new fabric.Text(title, {
                left: patternNumber ? 125 : 60,
                top: 52,
                fontSize: 36,
                fill: '#333333',
                fontFamily: getCurrentFontFamily(),
                fontWeight: 'bold',
                selectable: false
            });
            canvas.add(titleText);
            
            // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ï¼ˆç™½ã„èƒŒæ™¯ï¼‰- 888Ã—600pxç”¨ã«ã‚µã‚¤ã‚ºèª¿æ•´
            const contentWidth = 798;
            
            // æ›²ç·šçš„ãªé€æ˜åº¦å¤‰åŒ–ã‚’ä½œã‚‹ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆä¸­å¤®ã¾ã§ã¯ã‚†ã‚‹ã‚„ã‹ã€ãã®å¾Œæ€¥æ¿€ã«é€æ˜ã«ï¼‰
            const contentGradient = new fabric.Gradient({
                type: 'linear',
                coords: { x1: 0, y1: 0, x2: contentWidth, y2: 0 },
                colorStops: [
                    { offset: 0, color: hexToRgba(colors.accent, 0.9) },     // å·¦ç«¯ï¼š10%é€æ˜åº¦
                    { offset: 0.4, color: hexToRgba(colors.accent, 0.9) },   // 40%åœ°ç‚¹ï¼š10%é€æ˜åº¦
                    { offset: 0.6, color: hexToRgba(colors.accent, 0.8) },    // 60%åœ°ç‚¹ï¼š20%é€æ˜åº¦
                    { offset: 0.8, color: hexToRgba(colors.accent, 0.4) },    // 80%åœ°ç‚¹ï¼š60%é€æ˜åº¦
                    { offset: 1, color: hexToRgba(colors.accent, 0.1) }       // å³ç«¯ï¼š90%é€æ˜åº¦
                ]
            });
            
            const contentBg = new fabric.Rect({
                left: 45,
                top: 120,
                width: contentWidth,
                height: 435,
                fill: contentGradient,
                rx: 18,
                ry: 18,
                shadow: {
                    color: 'rgba(0,0,0,0.2)',
                    blur: 23,
                    offsetX: 0,
                    offsetY: 8
                },
                selectable: false
            });
            canvas.add(contentBg);
            
            let yPosition = 150;
            
            // èª¬æ˜ - 888Ã—600pxç”¨ã«ã‚µã‚¤ã‚ºèª¿æ•´
            if (description) {
                const formattedDescription = insertLineBreaks(description);
                const descText = new fabric.Textbox(formattedDescription, {
                    left: 75,
                    top: yPosition,
                    width: 738,
                    fontSize: 21,
                    fill: '#333333',
                    fontFamily: getCurrentFontFamily(),
                    selectable: false
                });
                canvas.add(descText);
                // ãƒ†ã‚­ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹ã®å®Ÿéš›ã®é«˜ã•ã‚’å–å¾—
                canvas.renderAll();
                const actualHeight = descText.calcTextHeight();
                yPosition += Math.max(90, actualHeight + 30);
            }
            
            // ã‚³ãƒ³ãƒ†ã‚¯ã‚¹ãƒˆ - 888Ã—600pxç”¨ã«ã‚µã‚¤ã‚ºèª¿æ•´
            if (context) {
                const contextLabel = new fabric.Text('ğŸ“ å ´é¢ãƒ»çŠ¶æ³', {
                    left: 75,
                    top: yPosition,
                    fontSize: 18,
                    fill: '#333333',
                    fontFamily: getCurrentFontFamily(),
                    fontWeight: 'bold',
                    selectable: false
                });
                canvas.add(contextLabel);
                
                const contextText = new fabric.Textbox(insertLineBreaks(context), {
                    left: 75,
                    top: yPosition + 30,
                    width: 738,
                    fontSize: 18,
                    fill: '#555555',
                    fontFamily: getCurrentFontFamily(),
                    selectable: false
                });
                canvas.add(contextText);
                canvas.renderAll();
                const contextHeight = contextText.calcTextHeight();
                yPosition += Math.max(105, contextHeight + 60);
            }
            
            // è§£æ±ºç­– - 888Ã—600pxç”¨ã«ã‚µã‚¤ã‚ºèª¿æ•´
            if (solution && yPosition < 480) {
                const solutionLabel = new fabric.Text('ğŸ’¡ å·¥å¤«ãƒ»ãƒˆãƒ©ã‚¤ã‚¢ãƒ«', {
                    left: 75,
                    top: yPosition,
                    fontSize: 18,
                    fill: '#333333',
                    fontFamily: getCurrentFontFamily(),
                    fontWeight: 'bold',
                    selectable: false
                });
                canvas.add(solutionLabel);
                
                const solutionText = new fabric.Textbox(insertLineBreaks(solution), {
                    left: 75,
                    top: yPosition + 30,
                    width: 738,
                    fontSize: 18,
                    fill: '#555555',
                    fontFamily: getCurrentFontFamily(),
                    selectable: false
                });
                canvas.add(solutionText);
            }
            
            canvas.renderAll();
        } catch (error) {
            console.error('ã‚«ãƒ¼ãƒ‰æ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
        }
    }
        
        // ç¾åœ¨ã®ã‚«ãƒ¼ãƒ‰ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ˆ888Ã—600pxå›ºå®šï¼‰
        function exportCurrentCard() {
            if (!canvas) {
                alert('ã‚«ãƒ¼ãƒ‰ãŒç”Ÿæˆã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚');
                return;
            }
            
            try {
                // 888Ã—600pxã§ãã®ã¾ã¾ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
                const title = document.getElementById('patternTitle').value || 'pattern-card';
                const safeTitle = title.replace(/[^\w\s-]/g, '').replace(/\s+/g, '-');
                const link = document.createElement('a');
                link.download = `${safeTitle}.png`;
                link.href = canvas.toDataURL('image/png');
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
            } catch (error) {
                console.error('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼:', error);
                alert('ã‚«ãƒ¼ãƒ‰ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
            }
        }
        
        // ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚°ãƒªãƒƒãƒ‰åˆæœŸåŒ–
        function initPatternGrid() {
            const grid = document.getElementById('patternGrid');
            for (let i = 0; i <= 39; i++) {
                const item = document.createElement('div');
                item.className = 'pattern-item';
                
                // ãƒ‘ã‚¿ãƒ¼ãƒ³ç•ªå·ã¨ã‚¿ã‚¤ãƒˆãƒ«ã‚’è¡¨ç¤º
                const patternTitle = patternData[i] ? patternData[i].title : 'ãƒ‘ã‚¿ãƒ¼ãƒ³';
                item.innerHTML = `
                    <div style="font-weight: bold; margin-bottom: 2px;">${i}</div>
                    <div style="font-size: 9px; line-height: 1.2; text-align: center;">${patternTitle}</div>
                `;
                
                item.onclick = () => togglePatternSelection(i, item);
                grid.appendChild(item);
            }
        }
        
        // ãƒ‘ã‚¿ãƒ¼ãƒ³é¸æŠåˆ‡ã‚Šæ›¿ãˆ
        function togglePatternSelection(patternId, element) {
            if (selectedPatterns.has(patternId)) {
                selectedPatterns.delete(patternId);
                element.classList.remove('selected');
            } else {
                selectedPatterns.add(patternId);
                element.classList.add('selected');
            }
            updateBatchButton();
        }
        
        // å…¨é¸æŠ
        function selectAllPatterns() {
            selectedPatterns.clear();
            for (let i = 0; i <= 39; i++) {
                selectedPatterns.add(i);
            }
            document.querySelectorAll('.pattern-item').forEach(item => item.classList.add('selected'));
            updateBatchButton();
        }
        
        // é¸æŠè§£é™¤
        function clearSelection() {
            selectedPatterns.clear();
            document.querySelectorAll('.pattern-item').forEach(item => item.classList.remove('selected'));
            updateBatchButton();
        }
        
        // ä¸€æ‹¬ç”Ÿæˆãƒœã‚¿ãƒ³æ›´æ–°
        function updateBatchButton() {
            const btn = document.getElementById('generateBatchBtn');
            btn.textContent = `ğŸ¨ é¸æŠã—ãŸã‚«ãƒ¼ãƒ‰ã‚’ä¸€æ‹¬ç”Ÿæˆ (${selectedPatterns.size})`;
            btn.disabled = selectedPatterns.size === 0;
        }
        
        // ä¸€æ‹¬ç”Ÿæˆ
        async function generateBatch() {
            if (selectedPatterns.size === 0) return;
            
            // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ–¹å¼ã®å–å¾—
            const downloadMethod = document.querySelector('input[name="presetDownloadMethod"]:checked').value;
            
            // ãƒ–ãƒ©ã‚¦ã‚¶ã®è‡ªå‹•ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰åˆ¶é™è­¦å‘Š
            if (selectedPatterns.size > 5 && downloadMethod === 'individual') {
                const userConfirm = confirm(`${selectedPatterns.size}å€‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ãŒãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ç¶šè¡Œã—ã¾ã™ã‹ï¼Ÿ`);
                if (!userConfirm) return;
            }
            
            let confirmMessage = `${selectedPatterns.size}æšã®ãƒ—ãƒªã‚»ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¾ã™ã€‚\n`;
            
            if (downloadMethod === 'zip') {
                confirmMessage += `\nãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ–¹å¼ï¼šZIPä¸€æ‹¬ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰\nZIPãƒ•ã‚¡ã‚¤ãƒ«åï¼šlearning_patterns.zip`;
            } else {
                confirmMessage += `\nãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ–¹å¼ï¼šå€‹åˆ¥ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰`;
            }
            
            confirmMessage += `\n\nã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ`;
            
            const confirmed = confirm(confirmMessage);
            if (!confirmed) return;
            
            if (downloadMethod === 'zip') {
                await generatePresetZipBatch();
            } else {
                await generatePresetIndividualBatch();
            }
        }
        
        // ãƒ—ãƒªã‚»ãƒƒãƒˆå€‹åˆ¥ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å‡¦ç†
        async function generatePresetIndividualBatch() {
            const progressBar = document.getElementById('presetProgressBar');
            const progressFill = document.getElementById('presetProgressFill');
            
            progressBar.style.display = 'block';
            
            let completed = 0;
            const total = selectedPatterns.size;
            
            try {
                for (const patternId of selectedPatterns) {
                    // ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’é©ç”¨
                    if (patternData[patternId]) {
                        const data = patternData[patternId];
                        document.getElementById('patternTitle').value = data.title;
                        document.getElementById('patternDescription').value = data.description;
                        document.getElementById('patternContext').value = data.context;
                        document.getElementById('patternSolution').value = data.solution;
                        document.getElementById('patternSelect').value = patternId;
                    }
                    
                    // ã‚«ãƒ¼ãƒ‰ç”Ÿæˆ
                    updateCard();
                    
                    // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å®Œäº†ã‚’å¾…ã¤
                    await new Promise(resolve => setTimeout(resolve, 150));
                    
                    // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼ˆæ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«å‘½åè¦å‰‡ï¼‰
                    try {
                        const link = document.createElement('a');
                        const filename = `learning_patterns_${patternId}`;
                        link.download = `${filename}.png`;
                        link.href = canvas.toDataURL('image/png');
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        
                    } catch (error) {
                        console.error(`ãƒ‘ã‚¿ãƒ¼ãƒ³${patternId}ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—:`, error);
                    }
                    
                    completed++;
                    const progress = (completed / total) * 100;
                    progressFill.style.width = progress + '%';
                    
                    // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰é–“éš”ã‚’èª¿æ•´ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶åˆ¶é™å›é¿ï¼‰
                    await new Promise(resolve => setTimeout(resolve, 300));
                }
                
                alert(`ãƒ—ãƒªã‚»ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ä¸€æ‹¬ç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸï¼\nç”Ÿæˆæ•°: ${completed}æš`);
                
            } catch (error) {
                console.error('ä¸€æ‹¬ç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);
                alert('ä¸€æ‹¬ç”Ÿæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
            }
            
            // å®Œäº†å¾Œã«ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã‚’éš ã™
            setTimeout(() => {
                progressBar.style.display = 'none';
                progressFill.style.width = '0%';
            }, 1000);
        }
        
        // ãƒ—ãƒªã‚»ãƒƒãƒˆZIPä¸€æ‹¬ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å‡¦ç†
        async function generatePresetZipBatch() {
            const progressBar = document.getElementById('presetProgressBar');
            const progressFill = document.getElementById('presetProgressFill');
            
            progressBar.style.display = 'block';
            
            let completed = 0;
            const total = selectedPatterns.size;
            
            // JSZipã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆ
            const zip = new JSZip();
            
            try {
                for (const patternId of selectedPatterns) {
                    // ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’é©ç”¨
                    if (patternData[patternId]) {
                        const data = patternData[patternId];
                        document.getElementById('patternTitle').value = data.title;
                        document.getElementById('patternDescription').value = data.description;
                        document.getElementById('patternContext').value = data.context;
                        document.getElementById('patternSolution').value = data.solution;
                        document.getElementById('patternSelect').value = patternId;
                    }
                    
                    // ã‚«ãƒ¼ãƒ‰ç”Ÿæˆ
                    updateCard();
                    
                    // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å®Œäº†ã‚’å¾…ã¤
                    await new Promise(resolve => setTimeout(resolve, 150));
                    
                    // ç”»åƒãƒ‡ãƒ¼ã‚¿ã‚’ZIPã«è¿½åŠ 
                    try {
                        const dataURL = canvas.toDataURL('image/png');
                        const base64Data = dataURL.split(',')[1]; // data:image/png;base64, ã‚’é™¤å»
                        
                        // ãƒ•ã‚¡ã‚¤ãƒ«åï¼šlearning_patterns_{ç•ªå·}.png
                        const filename = `learning_patterns_${patternId}.png`;
                        
                        zip.file(filename, base64Data, {base64: true});
                        
                    } catch (error) {
                        console.error(`ãƒ‘ã‚¿ãƒ¼ãƒ³${patternId}ã®ZIPè¿½åŠ ã«å¤±æ•—:`, error);
                    }
                    
                    completed++;
                    const progress = (completed / total) * 100;
                    progressFill.style.width = progress + '%';
                    
                    // å‡¦ç†é–“éš”ã‚’èª¿æ•´ï¼ˆZIPã®å ´åˆã¯çŸ­ãï¼‰
                    await new Promise(resolve => setTimeout(resolve, 100));
                }
                
                // ZIPç”Ÿæˆã¨ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                progressFill.innerHTML = '<span style="color: white; font-size: 12px;">ZIPç”Ÿæˆä¸­...</span>';
                
                const content = await zip.generateAsync({
                    type: "blob",
                    compression: "DEFLATE",
                    compressionOptions: {
                        level: 6
                    }
                });
                
                // ZIPãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                const link = document.createElement('a');
                link.download = 'learning_patterns.zip';
                link.href = URL.createObjectURL(content);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆURLã‚’è§£æ”¾
                URL.revokeObjectURL(link.href);
                
                alert(`ãƒ—ãƒªã‚»ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ZIPä¸€æ‹¬ç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸï¼\nç”Ÿæˆæ•°: ${completed}æš\nZIPãƒ•ã‚¡ã‚¤ãƒ«: learning_patterns.zip`);
                
            } catch (error) {
                console.error('ZIPä¸€æ‹¬ç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);
                alert('ZIPä¸€æ‹¬ç”Ÿæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
            }
            
            // å®Œäº†å¾Œã«ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã‚’éš ã™
            setTimeout(() => {
                progressBar.style.display = 'none';
                progressFill.style.width = '0%';
                progressFill.innerHTML = '';
            }, 1000);
        }
        
        // ãƒ•ã‚©ãƒ³ãƒˆé–¢é€£æ©Ÿèƒ½
        
        // WebFontã®å‹•çš„èª­ã¿è¾¼ã¿
        function loadWebFont(fontKey) {
            const font = fontDefinitions[fontKey];
            if (!font.webFont) return Promise.resolve(); // WebFontãŒä¸è¦ãªå ´åˆ
            
            return new Promise((resolve, reject) => {
                // æ—¢ã«èª­ã¿è¾¼ã¿æ¸ˆã¿ã‹ãƒã‚§ãƒƒã‚¯
                const existingLink = document.querySelector(`link[href="${font.webFont}"]`);
                if (existingLink) {
                    resolve();
                    return;
                }
                
                // WebFontèª­ã¿è¾¼ã¿
                const link = document.createElement('link');
                link.rel = 'stylesheet';
                link.href = font.webFont;
                link.onload = () => {
                    console.log(`WebFont loaded: ${font.name}`);
                    // ãƒ•ã‚©ãƒ³ãƒˆèª­ã¿è¾¼ã¿å®Œäº†ã¾ã§å°‘ã—å¾…ã¤
                    setTimeout(resolve, 200);
                };
                link.onerror = () => {
                    console.warn(`WebFont load failed: ${font.name}`);
                    resolve(); // ã‚¨ãƒ©ãƒ¼ã§ã‚‚ç¶šè¡Œ
                };
                
                document.head.appendChild(link);
            });
        }
        
        // ãƒ•ã‚©ãƒ³ãƒˆå¤‰æ›´
        async function changeFont() {
            const fontSelect = document.getElementById('fontSelect');
            const selectedFont = fontSelect.value;
            
            try {
                // WebFontèª­ã¿è¾¼ã¿
                await loadWebFont(selectedFont);
                
                // ç¾åœ¨ã®ãƒ•ã‚©ãƒ³ãƒˆã‚’æ›´æ–°
                currentFont = selectedFont;
                
                // ã‚«ãƒ¼ãƒ‰ã‚’å†æç”»
                updateCard();
                
                console.log(`ãƒ•ã‚©ãƒ³ãƒˆå¤‰æ›´å®Œäº†: ${fontDefinitions[selectedFont].name}`);
                
            } catch (error) {
                console.error('ãƒ•ã‚©ãƒ³ãƒˆå¤‰æ›´ã‚¨ãƒ©ãƒ¼:', error);
                alert('ãƒ•ã‚©ãƒ³ãƒˆã®å¤‰æ›´ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
            }
        }
        
        // ãƒ•ã‚©ãƒ³ãƒˆãƒ•ã‚¡ãƒŸãƒªãƒ¼ã‚’å–å¾—
        function getCurrentFontFamily() {
            return fontDefinitions[currentFont]?.family || fontDefinitions.hiragino.family;
        }
        function resetAll() {
            document.getElementById('patternSelect').value = '';
            document.getElementById('patternTitle').value = '';
            document.getElementById('patternDescription').value = '';
            document.getElementById('patternContext').value = '';
            document.getElementById('patternSolution').value = '';
            document.getElementById('fontSelect').value = 'hiragino'; // ãƒ•ã‚©ãƒ³ãƒˆã‚‚ãƒªã‚»ãƒƒãƒˆ
            currentFont = 'hiragino';
            clearSelection();
            clearCSVData(); // CSVãƒ‡ãƒ¼ã‚¿ã‚‚ã‚¯ãƒªã‚¢ï¼ˆç·¨é›†ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚‚éè¡¨ç¤ºã«ãªã‚‹ï¼‰
            updateCard();
        }
        
        // CSVé–¢é€£æ©Ÿèƒ½
        
        // CSVãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
        function downloadCSVTemplate() {
            const csvContent = 'pattern_number,title,description,context,solution\n' +
                              '1,ã‚µãƒ³ãƒ—ãƒ«ãƒ‘ã‚¿ãƒ¼ãƒ³1,å­¦ç¿’ã«é–¢ã™ã‚‹èª¬æ˜æ–‡,é©ç”¨ã•ã‚Œã‚‹å ´é¢ãƒ»çŠ¶æ³,å·¥å¤«ã‚„ãƒˆãƒ©ã‚¤ã‚¢ãƒ«å†…å®¹\n' +
                              '2,ã‚µãƒ³ãƒ—ãƒ«ãƒ‘ã‚¿ãƒ¼ãƒ³2,å­¦ç¿’ã«é–¢ã™ã‚‹èª¬æ˜æ–‡2,é©ç”¨ã•ã‚Œã‚‹å ´é¢ãƒ»çŠ¶æ³2,å·¥å¤«ã‚„ãƒˆãƒ©ã‚¤ã‚¢ãƒ«å†…å®¹2\n' +
                              ',ç‹¬è‡ªãƒ‘ã‚¿ãƒ¼ãƒ³,èª¬æ˜æ–‡ï¼ˆãƒ‘ã‚¿ãƒ¼ãƒ³ç•ªå·ã¯ä»»æ„ï¼‰,å ´é¢ãƒ»çŠ¶æ³,å·¥å¤«ãƒ»ãƒˆãƒ©ã‚¤ã‚¢ãƒ«';
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'pattern_card_template.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å‡¦ç†
        async function handleCSVUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ãƒã‚§ãƒƒã‚¯ï¼ˆ.csv ã¨ .txt ä¸¡æ–¹å¯¾å¿œï¼‰
            if (!file.name.match(/\.(csv|txt)$/i)) {
                alert('CSVã¾ãŸã¯TXTãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚\n\nå¯¾å¿œå½¢å¼ï¼š\nâ€¢ .csv ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆExcelç­‰ã§ä½œæˆï¼‰\nâ€¢ .txt ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆClaudeç­‰ã®AIãƒ„ãƒ¼ãƒ«ã§ä½œæˆï¼‰');
                return;
            }
            
            try {
                const text = await readFileAsText(file);
                
                // CSVå½¢å¼ã®åŸºæœ¬æ¤œè¨¼ï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã‹ãƒã‚§ãƒƒã‚¯ï¼‰
                if (!text.includes(',')) {
                    alert('ãƒ•ã‚¡ã‚¤ãƒ«ãŒCSVå½¢å¼ï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚\n\nAIãƒ„ãƒ¼ãƒ«ã§ä½œæˆã—ãŸå ´åˆã¯ã€CSVå½¢å¼ã§å‡ºåŠ›ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚\n\næ­£ã—ã„å½¢å¼ä¾‹ï¼š\ntitle,description,context,solution,pattern_number');
                    return;
                }
                
                const data = parseCSV(text);
                const validatedData = validateCSVData(data);
                
                if (validatedData.length === 0) {
                    alert('æœ‰åŠ¹ãªãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚\n\nãƒ•ã‚¡ã‚¤ãƒ«ãŒCSVå½¢å¼ã§ã€å¿…è¦ãªåˆ—ï¼ˆtitle, description, context, solutionï¼‰ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
                    return;
                }
                
                csvData = validatedData;
                displayCSVPreview(validatedData);
                document.getElementById('generateCSVBtn').style.display = 'inline-flex';
                document.getElementById('fileNameCustomization').style.display = 'flex';
                
            } catch (error) {
                alert('ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚\n\nã‚¨ãƒ©ãƒ¼è©³ç´°: ' + error.message + '\n\nãƒ•ã‚¡ã‚¤ãƒ«ãŒCSVå½¢å¼ï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰ã§ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
                console.error('ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
            }
        }
        
        // ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ†ã‚­ã‚¹ãƒˆã¨ã—ã¦èª­ã¿è¾¼ã¿
        function readFileAsText(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => resolve(e.target.result);
                reader.onerror = () => reject(new Error('ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼'));
                reader.readAsText(file, 'UTF-8');
            });
        }
        
        // CSVè§£æ
        function parseCSV(text) {
            const lines = text.split('\n').filter(line => line.trim());
            if (lines.length < 2) {
                throw new Error('CSVãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã¨ãƒ‡ãƒ¼ã‚¿è¡ŒãŒå¿…è¦ã§ã™ã€‚');
            }
            
            const headers = lines[0].split(',').map(h => h.trim().replace(/["']/g, ''));
            const data = [];
            
            for (let i = 1; i < lines.length; i++) {
                const values = parseCSVLine(lines[i]);
                if (values.length === headers.length) {
                    const row = {};
                    headers.forEach((header, index) => {
                        row[header] = values[index].trim().replace(/["']/g, '');
                    });
                    data.push(row);
                }
            }
            
            return data;
        }
        
        // CSVè¡Œã®è§£æï¼ˆã‚«ãƒ³ãƒã¨ã‚¯ã‚©ãƒ¼ãƒˆå‡¦ç†ï¼‰
        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"' || char === "'") {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current);
                    current = '';
                } else {
                    current += char;
                }
            }
            
            result.push(current);
            return result;
        }
        
        // CSVãƒ‡ãƒ¼ã‚¿ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
        function validateCSVData(data) {
            const requiredFields = ['title', 'description', 'context', 'solution'];
            const validated = [];
            
            for (const row of data) {
                // å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒã‚§ãƒƒã‚¯
                let isValid = true;
                for (const field of requiredFields) {
                    if (!row[field] || row[field].trim() === '') {
                        console.warn(`è¡Œã‚¹ã‚­ãƒƒãƒ—: ${field}ãŒç©ºã§ã™`, row);
                        isValid = false;
                        break;
                    }
                }
                
                if (!isValid) continue;
                
                // ãƒ‘ã‚¿ãƒ¼ãƒ³ç•ªå·ã®æ­£è¦åŒ–
                if (!row.pattern_number || row.pattern_number.trim() === '') {
                    row.pattern_number = null;
                } else {
                    // ãƒ‘ã‚¿ãƒ¼ãƒ³ç•ªå·ã‚’æ–‡å­—åˆ—ã¨ã—ã¦ä¿æŒ
                    row.pattern_number = row.pattern_number.trim();
                }
                
                validated.push(row);
            }
            
            return validated;
        }
        
        // CSVãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º
        function displayCSVPreview(data) {
            const preview = document.getElementById('csvPreview');
            const table = document.getElementById('csvDataTable');
            const stats = document.getElementById('csvStats');
            
            // ãƒ†ãƒ¼ãƒ–ãƒ«ç”Ÿæˆ
            let html = '<table style="width: 100%; border-collapse: collapse; font-size: 12px;">';
            html += '<thead><tr style="background: #667eea; color: white;">';
            html += '<th style="padding: 8px; border: 1px solid #ddd;">ç•ªå·</th>';
            html += '<th style="padding: 8px; border: 1px solid #ddd;">ã‚¿ã‚¤ãƒˆãƒ«</th>';
            html += '<th style="padding: 8px; border: 1px solid #ddd;">èª¬æ˜</th>';
            html += '<th style="padding: 8px; border: 1px solid #ddd;">å ´é¢ãƒ»çŠ¶æ³</th>';
            html += '<th style="padding: 8px; border: 1px solid #ddd;">å·¥å¤«ãƒ»ãƒˆãƒ©ã‚¤ã‚¢ãƒ«</th>';
            html += '<th style="padding: 8px; border: 1px solid #ddd;">æ“ä½œ</th>';
            html += '</tr></thead><tbody>';
            
            data.forEach((row, index) => {
                html += `<tr id="csvRow${index}" style="background: ${index % 2 === 0 ? '#ffffff' : '#f8f9ff'};">`;
                html += `<td style="padding: 6px; border: 1px solid #ddd; text-align: center;">${row.pattern_number || '-'}</td>`;
                html += `<td style="padding: 6px; border: 1px solid #ddd;">${row.title}</td>`;
                html += `<td style="padding: 6px; border: 1px solid #ddd;">${row.description.substring(0, 30)}${row.description.length > 30 ? '...' : ''}</td>`;
                html += `<td style="padding: 6px; border: 1px solid #ddd;">${row.context.substring(0, 25)}${row.context.length > 25 ? '...' : ''}</td>`;
                html += `<td style="padding: 6px; border: 1px solid #ddd;">${row.solution.substring(0, 25)}${row.solution.length > 25 ? '...' : ''}</td>`;
                html += `<td style="padding: 6px; border: 1px solid #ddd; text-align: center;">`;
                html += `<button onclick="editCSVRow(${index})" class="csv-edit-button">âœï¸ç·¨é›†</button>`;
                html += `</td>`;
                html += '</tr>';
            });
            
            html += '</tbody></table>';
            table.innerHTML = html;
            
            // çµ±è¨ˆæƒ…å ±
            const withNumbers = data.filter(row => row.pattern_number).length;
            const withoutNumbers = data.length - withNumbers;
            
            stats.innerHTML = `ğŸ“Š èª­ã¿è¾¼ã¿ä»¶æ•°: ${data.length}ä»¶ | ç•ªå·ä»˜ã: ${withNumbers}ä»¶, ç•ªå·ãªã—: ${withoutNumbers}ä»¶ | ä½¿ç”¨ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ: ${currentTemplate}`;
            
            preview.style.display = 'block';
            document.getElementById('downloadMethodSection').style.display = 'block';
        }
        
        // CSVãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢
        function clearCSVData() {
            csvData = [];
            document.getElementById('csvPreview').style.display = 'none';
            document.getElementById('downloadMethodSection').style.display = 'none';
            document.getElementById('generateCSVBtn').style.display = 'none';
            document.getElementById('fileNameCustomization').style.display = 'none';
            document.getElementById('csvFileInput').value = '';
            document.getElementById('cardGroupName').value = '';
            
            // CSVç·¨é›†ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚‚éè¡¨ç¤ºãƒ»ãƒã‚¤ãƒ©ã‚¤ãƒˆè§£é™¤
            document.getElementById('csvEditSection').style.display = 'none';
            document.querySelectorAll('.csv-row-editing').forEach(row => {
                row.classList.remove('csv-row-editing');
            });
            editingCSVIndex = -1;
            originalCSVData = null;
        }
        
        // CSVä¸€æ‹¬ç”Ÿæˆ
        async function generateCSVBatch() {
            if (csvData.length === 0) {
                alert('CSV ãƒ‡ãƒ¼ã‚¿ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã€‚');
                return;
            }
            
            // ã‚«ãƒ¼ãƒ‰ã‚°ãƒ«ãƒ¼ãƒ—åã®å–å¾—ã¨æ¤œè¨¼
            const cardGroupName = document.getElementById('cardGroupName').value.trim();
            if (!cardGroupName) {
                alert('ã‚«ãƒ¼ãƒ‰ã‚°ãƒ«ãƒ¼ãƒ—åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\n\nä¾‹ï¼šãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆA\nâ†’ãƒ•ã‚¡ã‚¤ãƒ«åï¼šãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆA_1.png');
                document.getElementById('cardGroupName').focus();
                return;
            }
            
            // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ–¹å¼ã®å–å¾—
            const downloadMethod = document.querySelector('input[name="downloadMethod"]:checked').value;
            
            // ãƒ•ã‚¡ã‚¤ãƒ«åã«ä½¿ç”¨ã§ããªã„æ–‡å­—ã‚’å®‰å…¨ãªæ–‡å­—ã«å¤‰æ›
            const safeGroupName = cardGroupName.replace(/[<>:"/\\|?*]/g, '-').replace(/\s+/g, '_');
            
            let confirmMessage = `${csvData.length}æšã®ã‚«ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¾ã™ã€‚\nç¾åœ¨é¸æŠä¸­ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã€Œ${currentTemplate}ã€ã‚’å…¨ã‚«ãƒ¼ãƒ‰ã«é©ç”¨ã—ã¾ã™ã€‚\nãƒ•ã‚¡ã‚¤ãƒ«åå½¢å¼ï¼š${safeGroupName}_1.png, ${safeGroupName}_2.png...\n`;
            
            if (downloadMethod === 'zip') {
                confirmMessage += `\nãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ–¹å¼ï¼šZIPä¸€æ‹¬ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰\nZIPãƒ•ã‚¡ã‚¤ãƒ«åï¼š${safeGroupName}_pattern_cards.zip`;
            } else {
                confirmMessage += `\nãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ–¹å¼ï¼šå€‹åˆ¥ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰`;
            }
            
            confirmMessage += `\n\nã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ\n\nâ€»ãƒ–ãƒ©ã‚¦ã‚¶ã«ã‚ˆã£ã¦ã¯ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãŒåˆ¶é™ã•ã‚Œã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚`;
            
            const confirmed = confirm(confirmMessage);
            if (!confirmed) return;
            
            if (downloadMethod === 'zip') {
                await generateZipBatch(safeGroupName);
            } else {
                await generateIndividualBatch(safeGroupName);
            }
        }
        
        // å€‹åˆ¥ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å‡¦ç†
        async function generateIndividualBatch(safeGroupName) {
            const progressBar = document.getElementById('csvProgressBar');
            const progressFill = document.getElementById('csvProgressFill');
            
            progressBar.style.display = 'block';
            
            // UIçŠ¶æ…‹ä¿å­˜ï¼ˆä¸€æ‹¬ç”Ÿæˆä¸­ã®ãƒ‘ã‚¿ãƒ¼ãƒ³é¸æŠè¡¨ç¤ºå›ºå®šã®ãŸã‚ï¼‰
            const originalPatternValue = document.getElementById('patternSelect').value;
            
            let completed = 0;
            const total = csvData.length;
            
            try {
                for (const [index, row] of csvData.entries()) {
                    // ãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«è¨­å®š
                    document.getElementById('patternTitle').value = row.title;
                    document.getElementById('patternDescription').value = row.description;
                    document.getElementById('patternContext').value = row.context;
                    document.getElementById('patternSolution').value = row.solution;
                    
                    // ãƒ‘ã‚¿ãƒ¼ãƒ³ç•ªå·ã‚’è¨­å®šï¼ˆUIã«ã¯åæ˜ ã•ã›ãªã„ï¼‰
                    // æ³¨æ„: ãƒ‘ã‚¿ãƒ¼ãƒ³é¸æŠUIã¯å¤‰æ›´ã›ãšã€å†…éƒ¨çš„ã«ã®ã¿å‡¦ç†
                    if (row.pattern_number) {
                        // å†…éƒ¨çš„ã«ãƒ‘ã‚¿ãƒ¼ãƒ³ç•ªå·ã‚’ä¿æŒï¼ˆUIã¯å¤‰æ›´ã—ãªã„ï¼‰
                        // updateCard()ã§å¿…è¦ãªå ´åˆã¯åˆ¥é€”å¯¾å¿œ
                    }
                    
                    // ç¾åœ¨é¸æŠã•ã‚Œã¦ã„ã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ç¶­æŒï¼ˆå¤‰æ›´ã—ãªã„ï¼‰
                    // selectTemplate(currentTemplate); // ä¸è¦ï¼šæ—¢ã«é¸æŠæ¸ˆã¿
                    
                    // ã‚«ãƒ¼ãƒ‰ç”Ÿæˆ
                    updateCard();
                    
                    // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å®Œäº†ã‚’å¾…ã¤
                    await new Promise(resolve => setTimeout(resolve, 200));
                    
                    // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼ˆæ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«å‘½åè¦å‰‡ï¼‰
                    try {
                        const link = document.createElement('a');
                        // ã‚«ãƒ¼ãƒ‰ç•ªå·ã®æ±ºå®šï¼ˆCSVç•ªå·ãŒã‚ã‚‹å ´åˆã¯ãã‚Œã‚’ä½¿ç”¨ã€ãªã‘ã‚Œã°é€£ç•ªï¼‰
                        const cardNumber = row.pattern_number || (index + 1);
                        // æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«å‘½åè¦å‰‡ï¼š{ã‚°ãƒ«ãƒ¼ãƒ—å}_{ã‚«ãƒ¼ãƒ‰ç•ªå·}.png
                        const filename = `${safeGroupName}_${cardNumber}`;
                        link.download = `${filename}.png`;
                        link.href = canvas.toDataURL('image/png');
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        
                    } catch (error) {
                        console.error(`CSVè¡Œ${index + 1}ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—:`, error);
                    }
                    
                    completed++;
                    const progress = (completed / total) * 100;
                    progressFill.style.width = progress + '%';
                    
                    // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰é–“éš”ã‚’èª¿æ•´
                    await new Promise(resolve => setTimeout(resolve, 400));
                }
                
                alert(`CSVä¸€æ‹¬ç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸï¼\nç”Ÿæˆæ•°: ${completed}æš\nãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ: ${currentTemplate}`);
                
            } catch (error) {
                console.error('CSVä¸€æ‹¬ç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);
                alert('CSVä¸€æ‹¬ç”Ÿæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
            }
            
            // UIçŠ¶æ…‹å¾©å…ƒï¼ˆãƒ‘ã‚¿ãƒ¼ãƒ³é¸æŠã‚’å…ƒã®çŠ¶æ…‹ã«æˆ»ã™ï¼‰
            document.getElementById('patternSelect').value = originalPatternValue;
            // å…ƒã®çŠ¶æ…‹ã§ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºã‚’æ›´æ–°
            updateCard();
            
            // å®Œäº†å¾Œã«ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã‚’éš ã™
            setTimeout(() => {
                progressBar.style.display = 'none';
                progressFill.style.width = '0%';
            }, 1000);
        }
        
        // ZIPä¸€æ‹¬ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å‡¦ç†
        async function generateZipBatch(safeGroupName) {
            const progressBar = document.getElementById('csvProgressBar');
            const progressFill = document.getElementById('csvProgressFill');
            
            progressBar.style.display = 'block';
            
            // UIçŠ¶æ…‹ä¿å­˜ï¼ˆä¸€æ‹¬ç”Ÿæˆä¸­ã®ãƒ‘ã‚¿ãƒ¼ãƒ³é¸æŠè¡¨ç¤ºå›ºå®šã®ãŸã‚ï¼‰
            const originalPatternValue = document.getElementById('patternSelect').value;
            
            let completed = 0;
            const total = csvData.length;
            
            // JSZipã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆ
            const zip = new JSZip();
            
            try {
                for (const [index, row] of csvData.entries()) {
                    // ãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«è¨­å®š
                    document.getElementById('patternTitle').value = row.title;
                    document.getElementById('patternDescription').value = row.description;
                    document.getElementById('patternContext').value = row.context;
                    document.getElementById('patternSolution').value = row.solution;
                    
                    // ãƒ‘ã‚¿ãƒ¼ãƒ³ç•ªå·ã‚’è¨­å®šï¼ˆUIã«ã¯åæ˜ ã•ã›ãªã„ï¼‰
                    // æ³¨æ„: ãƒ‘ã‚¿ãƒ¼ãƒ³é¸æŠUIã¯å¤‰æ›´ã›ãšã€å†…éƒ¨çš„ã«ã®ã¿å‡¦ç†
                    if (row.pattern_number) {
                        // å†…éƒ¨çš„ã«ãƒ‘ã‚¿ãƒ¼ãƒ³ç•ªå·ã‚’ä¿æŒï¼ˆUIã¯å¤‰æ›´ã—ãªã„ï¼‰
                        // updateCard()ã§å¿…è¦ãªå ´åˆã¯åˆ¥é€”å¯¾å¿œ
                    }
                    
                    // ã‚«ãƒ¼ãƒ‰ç”Ÿæˆ
                    updateCard();
                    
                    // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å®Œäº†ã‚’å¾…ã¤
                    await new Promise(resolve => setTimeout(resolve, 200));
                    
                    // ç”»åƒãƒ‡ãƒ¼ã‚¿ã‚’ZIPã«è¿½åŠ 
                    try {
                        const dataURL = canvas.toDataURL('image/png');
                        const base64Data = dataURL.split(',')[1]; // data:image/png;base64, ã‚’é™¤å»
                        
                        // ã‚«ãƒ¼ãƒ‰ç•ªå·ã®æ±ºå®šï¼ˆCSVç•ªå·ãŒã‚ã‚‹å ´åˆã¯ãã‚Œã‚’ä½¿ç”¨ã€ãªã‘ã‚Œã°é€£ç•ªï¼‰
                        const cardNumber = row.pattern_number || (index + 1);
                        // ãƒ•ã‚¡ã‚¤ãƒ«åï¼š{ã‚°ãƒ«ãƒ¼ãƒ—å}_{ã‚«ãƒ¼ãƒ‰ç•ªå·}.png
                        const filename = `${safeGroupName}_${cardNumber}.png`;
                        
                        zip.file(filename, base64Data, {base64: true});
                        
                    } catch (error) {
                        console.error(`CSVè¡Œ${index + 1}ã®ZIPè¿½åŠ ã«å¤±æ•—:`, error);
                    }
                    
                    completed++;
                    const progress = (completed / total) * 100;
                    progressFill.style.width = progress + '%';
                    
                    // å‡¦ç†é–“éš”ã‚’èª¿æ•´ï¼ˆZIPã®å ´åˆã¯çŸ­ãï¼‰
                    await new Promise(resolve => setTimeout(resolve, 100));
                }
                
                // ZIPç”Ÿæˆã¨ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                progressFill.innerHTML = '<span style="color: white; font-size: 12px;">ZIPç”Ÿæˆä¸­...</span>';
                
                const content = await zip.generateAsync({
                    type: "blob",
                    compression: "DEFLATE",
                    compressionOptions: {
                        level: 6
                    }
                });
                
                // ZIPãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                const link = document.createElement('a');
                link.download = `${safeGroupName}_pattern_cards.zip`;
                link.href = URL.createObjectURL(content);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆURLã‚’è§£æ”¾
                URL.revokeObjectURL(link.href);
                
                alert(`ZIPä¸€æ‹¬ç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸï¼\nç”Ÿæˆæ•°: ${completed}æš\nãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ: ${currentTemplate}\nZIPãƒ•ã‚¡ã‚¤ãƒ«: ${safeGroupName}_pattern_cards.zip`);
                
            } catch (error) {
                console.error('ZIPä¸€æ‹¬ç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);
                alert('ZIPä¸€æ‹¬ç”Ÿæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
            }
            
            // UIçŠ¶æ…‹å¾©å…ƒï¼ˆãƒ‘ã‚¿ãƒ¼ãƒ³é¸æŠã‚’å…ƒã®çŠ¶æ…‹ã«æˆ»ã™ï¼‰
            document.getElementById('patternSelect').value = originalPatternValue;
            // å…ƒã®çŠ¶æ…‹ã§ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºã‚’æ›´æ–°
            updateCard();
            
            // å®Œäº†å¾Œã«ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã‚’éš ã™
            setTimeout(() => {
                progressBar.style.display = 'none';
                progressFill.style.width = '0%';
                progressFill.innerHTML = '';
            }, 1000);
        }
        
        // CSVè¡Œç·¨é›†æ©Ÿèƒ½
        let editingCSVIndex = -1;
        let originalCSVData = null;
        
        function editCSVRow(index) {
            if (index < 0 || index >= csvData.length) return;
            
            editingCSVIndex = index;
            const row = csvData[index];
            
            // ä»¥å‰ã®ç·¨é›†è¡Œã®ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’å‰Šé™¤
            document.querySelectorAll('.csv-row-editing').forEach(row => {
                row.classList.remove('csv-row-editing');
            });
            
            // ç¾åœ¨ã®ç·¨é›†è¡Œã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
            const currentRow = document.getElementById(`csvRow${index}`);
            if (currentRow) {
                currentRow.classList.add('csv-row-editing');
            }
            
            // ç·¨é›†ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
            document.getElementById('csvEditSection').style.display = 'block';
            
            // ç·¨é›†æƒ…å ±ã‚’è¡¨ç¤º
            document.getElementById('csvEditInfo').textContent = `è¡Œ ${index + 1} / ${csvData.length} ã‚’ç·¨é›†ä¸­ - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ã‚«ãƒ¼ãƒ‰ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒæ›´æ–°ã•ã‚Œã¾ã™`;
            
            // ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«å€¤ã‚’è¨­å®š
            document.getElementById('csvEditNumber').value = row.pattern_number || '';
            document.getElementById('csvEditTitle').value = row.title || '';
            document.getElementById('csvEditDescription').value = row.description || '';
            document.getElementById('csvEditContext').value = row.context || '';
            document.getElementById('csvEditSolution').value = row.solution || '';
            
            // å…ƒã®ãƒ¡ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ã®å€¤ã‚’ä¿å­˜
            originalCSVData = {
                patternSelect: document.getElementById('patternSelect').value,
                patternTitle: document.getElementById('patternTitle').value,
                patternDescription: document.getElementById('patternDescription').value,
                patternContext: document.getElementById('patternContext').value,
                patternSolution: document.getElementById('patternSolution').value
            };
            
            // ç·¨é›†ä¸­ã®ãƒ‡ãƒ¼ã‚¿ã§ã‚«ãƒ¼ãƒ‰ã‚’æ›´æ–°
            updateCardFromCSVEdit();
            
            // ç·¨é›†ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ã‚¹ãƒ ãƒ¼ã‚ºã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
            document.getElementById('csvEditSection').scrollIntoView({ 
                behavior: 'smooth', 
                block: 'nearest' 
            });
        }
        
        function updateCardFromCSVEdit() {
            if (editingCSVIndex === -1) return;
            
            // ç·¨é›†ä¸­ã®å€¤ã‚’ãƒ¡ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ã«åæ˜ 
            document.getElementById('patternSelect').value = document.getElementById('csvEditNumber').value;
            document.getElementById('patternTitle').value = document.getElementById('csvEditTitle').value;
            document.getElementById('patternDescription').value = document.getElementById('csvEditDescription').value;
            document.getElementById('patternContext').value = document.getElementById('csvEditContext').value;
            document.getElementById('patternSolution').value = document.getElementById('csvEditSolution').value;
            
            // ã‚«ãƒ¼ãƒ‰ã‚’æ›´æ–°
            updateCard();
        }
        
        function applyCSVEdit() {
            if (editingCSVIndex === -1) return;
            
            // CSVãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°
            csvData[editingCSVIndex] = {
                pattern_number: document.getElementById('csvEditNumber').value || null,
                title: document.getElementById('csvEditTitle').value,
                description: document.getElementById('csvEditDescription').value,
                context: document.getElementById('csvEditContext').value,
                solution: document.getElementById('csvEditSolution').value
            };
            
            // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ›´æ–°
            displayCSVPreview(csvData);
            
            // ç·¨é›†å®Œäº†
            cancelCSVEdit();
            
            alert('ç·¨é›†å†…å®¹ã‚’CSVãƒ‡ãƒ¼ã‚¿ã«é©ç”¨ã—ã¾ã—ãŸã€‚');
        }
        
        function cancelCSVEdit() {
            // ç·¨é›†è¡Œã®ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’å‰Šé™¤
            document.querySelectorAll('.csv-row-editing').forEach(row => {
                row.classList.remove('csv-row-editing');
            });
            
            // ç·¨é›†ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’éè¡¨ç¤º
            document.getElementById('csvEditSection').style.display = 'none';
            editingCSVIndex = -1;
            
            // å…ƒã®ãƒ•ã‚©ãƒ¼ãƒ å€¤ã‚’å¾©å…ƒ
            if (originalCSVData) {
                document.getElementById('patternSelect').value = originalCSVData.patternSelect;
                document.getElementById('patternTitle').value = originalCSVData.patternTitle;
                document.getElementById('patternDescription').value = originalCSVData.patternDescription;
                document.getElementById('patternContext').value = originalCSVData.patternContext;
                document.getElementById('patternSolution').value = originalCSVData.patternSolution;
                
                // ã‚«ãƒ¼ãƒ‰ã‚’å…ƒã«æˆ»ã™
                updateCard();
                
                originalCSVData = null;
            }
        }
        
        // åˆæœŸåŒ–
        function initialize() {
            // Fabric.jsãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
            if (typeof fabric === 'undefined') {
                setTimeout(initialize, 100);
                return;
            }
            initCanvas();
            initPatternGrid();
            updateBatchButton();
            
            // CSVæ©Ÿèƒ½ã®åˆæœŸåŒ–
            clearCSVData();
            
            // ãƒ•ã‚©ãƒ³ãƒˆåˆæœŸåŒ–
            currentFont = 'hiragino';
            document.getElementById('fontSelect').value = 'hiragino';
        }
        
        window.addEventListener('load', initialize);

        // AIæ´»ç”¨ã‚¬ã‚¤ãƒ‰é–¢é€£ã®é–¢æ•°
        function toggleAIGuide() {
            const content = document.getElementById('aiGuideContent');
            const toggle = document.getElementById('aiGuideToggle');
            
            if (content.classList.contains('expanded')) {
                content.classList.remove('expanded');
                toggle.classList.remove('expanded');
                toggle.textContent = 'â–¼';
            } else {
                content.classList.add('expanded');
                toggle.classList.add('expanded');
                toggle.textContent = 'â–²';
            }
        }

        function copyTemplate(button, type) {
            const textarea = button.previousElementSibling;
            const text = textarea.value;
            
            // ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼
            navigator.clipboard.writeText(text).then(() => {
                // ãƒœã‚¿ãƒ³ã®è¡¨ç¤ºã‚’å¤‰æ›´
                const originalText = button.textContent;
                button.textContent = 'âœ“ ã‚³ãƒ”ãƒ¼å®Œäº†!';
                button.classList.add('copied');
                
                // 2ç§’å¾Œã«å…ƒã«æˆ»ã™
                setTimeout(() => {
                    button.textContent = originalText;
                    button.classList.remove('copied');
                }, 2000);
            }).catch(err => {
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: ãƒ†ã‚­ã‚¹ãƒˆã‚’é¸æŠ
                textarea.select();
                textarea.setSelectionRange(0, 99999);
                document.execCommand('copy');
                
                const originalText = button.textContent;
                button.textContent = 'âœ“ ã‚³ãƒ”ãƒ¼å®Œäº†!';
                button.classList.add('copied');
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.classList.remove('copied');
                }, 2000);
            });
        }
    </script>
</body>
</html>
